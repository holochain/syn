var app=function(){"use strict";function t(){}function e(t){return t()}function n(){return Object.create(null)}function r(t){t.forEach(e)}function i(t){return"function"==typeof t}function o(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}let s,a;function c(e,...n){if(null==e)return t;const r=e.subscribe(...n);return r.unsubscribe?()=>r.unsubscribe():r}function u(t){let e;return c(t,(t=>e=t))(),e}function l(t,e,n){t.$$.on_destroy.push(c(e,n))}function h(t,e){t.appendChild(e)}function f(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function p(t){return document.createElement(t)}function y(t){return document.createTextNode(t)}function v(){return y(" ")}function g(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function m(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function b(t,e,n){e in t?t[e]="boolean"==typeof t[e]&&""===n||n:m(t,e,n)}function w(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function _(t,e){t.value=null==e?"":e}function x(t,e,n){t.classList[n?"add":"remove"](e)}function S(t){a=t}function E(){if(!a)throw new Error("Function called outside component initialization");return a}function C(){const t=E();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const i=function(t,e,n=!1){const r=document.createEvent("CustomEvent");return r.initCustomEvent(t,n,!1,e),r}(e,n);r.slice().forEach((e=>{e.call(t,i)}))}}}function k(t){return E().$$.context.get(t)}const $=[],U=[],A=[],j=[],O=Promise.resolve();let I=!1;function T(){I||(I=!0,O.then(R))}function P(t){A.push(t)}let L=!1;const B=new Set;function R(){if(!L){L=!0;do{for(let t=0;t<$.length;t+=1){const e=$[t];S(e),M(e.$$)}for(S(null),$.length=0;U.length;)U.pop()();for(let t=0;t<A.length;t+=1){const e=A[t];B.has(e)||(B.add(e),e())}A.length=0}while($.length);for(;j.length;)j.pop()();I=!1,L=!1,B.clear()}}function M(t){if(null!==t.fragment){t.update(),r(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(P)}}const D=new Set;let z;function H(){z={r:0,c:[],p:z}}function F(){z.r||r(z.c),z=z.p}function q(t,e){t&&t.i&&(D.delete(t),t.i(e))}function N(t,e,n,r){if(t&&t.o){if(D.has(t))return;D.add(t),z.c.push((()=>{D.delete(t),r&&(n&&t.d(1),r())})),t.o(e)}}const W="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:global;function V(t){t&&t.c()}function K(t,n,o,s){const{fragment:a,on_mount:c,on_destroy:u,after_update:l}=t.$$;a&&a.m(n,o),s||P((()=>{const n=c.map(e).filter(i);u?u.push(...n):r(n),t.$$.on_mount=[]})),l.forEach(P)}function Z(t,e){const n=t.$$;null!==n.fragment&&(r(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function G(e,i,o,s,c,u,l,h=[-1]){const f=a;S(e);const p=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:c,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f?f.$$.context:i.context||[]),callbacks:n(),dirty:h,skip_bound:!1,root:i.target||f.$$.root};l&&l(p.root);let y=!1;if(p.ctx=o?o(e,i.props||{},((t,n,...r)=>{const i=r.length?r[0]:n;return p.ctx&&c(p.ctx[t],p.ctx[t]=i)&&(!p.skip_bound&&p.bound[t]&&p.bound[t](i),y&&function(t,e){-1===t.$$.dirty[0]&&($.push(t),T(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}(e,t)),n})):[],p.update(),y=!0,r(p.before_update),p.fragment=!!s&&s(p.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);p.fragment&&p.fragment.l(t),t.forEach(d)}else p.fragment&&p.fragment.c();i.intro&&q(e.$$.fragment),K(e,i.target,i.anchor,i.customElement),R()}S(f)}class X{$destroy(){Z(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const J=[];function Y(t,e){return{subscribe:Q(t,e).subscribe}}function Q(e,n=t){let r;const i=new Set;function s(t){if(o(e,t)&&(e=t,r)){const t=!J.length;for(const t of i)t[1](),J.push(t,e);if(t){for(let t=0;t<J.length;t+=2)J[t][0](J[t+1]);J.length=0}}}return{set:s,update:function(t){s(t(e))},subscribe:function(o,a=t){const c=[o,a];return i.add(c),1===i.size&&(r=n(s)||t),o(e),()=>{i.delete(c),0===i.size&&(r(),r=null)}}}}function tt(e,n,o){const s=!Array.isArray(e),a=s?[e]:e,u=n.length<2;return Y(o,(e=>{let o=!1;const l=[];let h=0,f=t;const d=()=>{if(h)return;f();const r=n(s?l[0]:l,e);u?e(r):f=i(r)?r:t},p=a.map(((t,e)=>c(t,(t=>{l[e]=t,h&=~(1<<e),o&&d()}),(()=>{h|=1<<e}))));return o=!0,d(),function(){r(p),f()}}))}const et=Q(),nt=Q(),rt=Q(""),it=Q([]),ot=Q([]),st=Q([]),at=tt(ot,(t=>t.length));(function(){function t(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}if(!ShadowRoot.prototype.createElement){var e,n=window.HTMLElement,r=window.customElements.define,i=window.customElements.get,o=window.customElements,s=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap;window.CustomElementRegistry=function(){this.l=new Map,this.o=new Map,this.i=new Map,this.h=new Map},window.CustomElementRegistry.prototype.define=function(e,n){if(e=e.toLowerCase(),void 0!==this.j(e))throw new DOMException("Failed to execute 'define' on 'CustomElementRegistry': the name \""+e+'" has already been used with this registry');if(void 0!==this.o.get(n))throw new DOMException("Failed to execute 'define' on 'CustomElementRegistry': this constructor has already been used with this registry");var s=n.prototype.attributeChangedCallback,u=new Set(n.observedAttributes||[]);if(h(n,u,s),s={g:n,connectedCallback:n.prototype.connectedCallback,disconnectedCallback:n.prototype.disconnectedCallback,adoptedCallback:n.prototype.adoptedCallback,attributeChangedCallback:s,observedAttributes:u},this.l.set(e,s),this.o.set(n,s),(u=i.call(o,e))||(u=l(e),r.call(o,e,u)),this===window.customElements&&(c.set(n,s),s.s=u),u=this.h.get(e)){this.h.delete(e);var f="undefined"!=typeof Symbol&&Symbol.iterator&&u[Symbol.iterator];for(u=f?f.call(u):{next:t(u)},f=u.next();!f.done;f=u.next())f=f.value,a.delete(f),d(f,s,!0)}return void 0!==(s=this.i.get(e))&&(s.resolve(n),this.i.delete(e)),n},window.CustomElementRegistry.prototype.upgrade=function(){y.push(this),o.upgrade.apply(o,arguments),y.pop()},window.CustomElementRegistry.prototype.get=function(t){var e;return null==(e=this.l.get(t))?void 0:e.g},window.CustomElementRegistry.prototype.j=function(t){return this.l.get(t)},window.CustomElementRegistry.prototype.whenDefined=function(t){var e=this.j(t);if(void 0!==e)return Promise.resolve(e.g);var n=this.i.get(t);return void 0===n&&((n={}).promise=new Promise((function(t){return n.resolve=t})),this.i.set(t,n)),n.promise},window.CustomElementRegistry.prototype.m=function(t,e,n){var r=this.h.get(e);r||this.h.set(e,r=new Set),n?r.add(t):r.delete(t)},window.HTMLElement=function(){var t=e;if(t)return e=void 0,t;var r=c.get(this.constructor);if(!r)throw new TypeError("Illegal constructor (custom element class must be registered with global customElements registry to be newable)");return t=Reflect.construct(n,[],r.s),Object.setPrototypeOf(t,this.constructor.prototype),s.set(t,r),t},window.HTMLElement.prototype=n.prototype;var l=function(t){function e(){var e=Reflect.construct(n,[],this.constructor);Object.setPrototypeOf(e,HTMLElement.prototype);t:{var r=e.getRootNode();if(!(r===document||r instanceof ShadowRoot)){if((r=y[y.length-1])instanceof CustomElementRegistry){var i=r;break t}(r=r.getRootNode())===document||r instanceof ShadowRoot||(r=(null==(i=u.get(r))?void 0:i.getRootNode())||document)}i=r.customElements}return(r=(i=i||window.customElements).j(t))?d(e,r):a.set(e,i),e}return e.prototype.connectedCallback=function(){var e=s.get(this);e?e.connectedCallback&&e.connectedCallback.apply(this,arguments):a.get(this).m(this,t,!0)},e.prototype.disconnectedCallback=function(){var e=s.get(this);e?e.disconnectedCallback&&e.disconnectedCallback.apply(this,arguments):a.get(this).m(this,t,!1)},e.prototype.adoptedCallback=function(){var t,e;null==(t=s.get(this))||null==(e=t.adoptedCallback)||e.apply(this,arguments)},e},h=function(t,e,n){if(0!==e.size&&void 0!==n){var r=t.prototype.setAttribute;r&&(t.prototype.setAttribute=function(t,i){if(e.has(t)){var o=this.getAttribute(t);r.call(this,t,i),n.call(this,t,o,i)}else r.call(this,t,i)});var i=t.prototype.removeAttribute;i&&(t.prototype.removeAttribute=function(t){if(e.has(t)){var r=this.getAttribute(t);i.call(this,t),n.call(this,t,r,null)}else i.call(this,t)})}},f=function(t){var e=Object.getPrototypeOf(t);if(e!==window.HTMLElement)return e===n?Object.setPrototypeOf(t,window.HTMLElement):f(e)},d=function(t,n,r){r=void 0!==r&&r,Object.setPrototypeOf(t,n.g.prototype),s.set(t,n),e=t;try{new n.g}catch(t){f(n.g),new n.g}n.observedAttributes.forEach((function(e){t.hasAttribute(e)&&n.attributeChangedCallback.call(t,e,null,t.getAttribute(e))})),r&&n.connectedCallback&&t.isConnected&&n.connectedCallback.call(t)},p=Element.prototype.attachShadow;Element.prototype.attachShadow=function(t){var e=p.apply(this,arguments);return t.customElements&&(e.customElements=t.customElements),e};var y=[document],v=function(t,e,n){var r=(n?Object.getPrototypeOf(n):t.prototype)[e];t.prototype[e]=function(){y.push(this);var t=r.apply(n||this,arguments);return void 0!==t&&u.set(t,this),y.pop(),t}};v(ShadowRoot,"createElement",document),v(ShadowRoot,"importNode",document),v(Element,"insertAdjacentHTML");var g=function(t){var e=Object.getOwnPropertyDescriptor(t.prototype,"innerHTML");Object.defineProperty(t.prototype,"innerHTML",Object.assign({},e,{set:function(t){y.push(this),e.set.call(this,t),y.pop()}}))};g(Element),g(ShadowRoot),Object.defineProperty(window,"customElements",{value:new CustomElementRegistry,configurable:!0,writable:!0})}}).call(self);const ct=new WeakMap;
/**
     * @license
     * Copyright 2019 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
const ut=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,lt=Symbol(),ht=new Map;class ft{constructor(t,e){if(this._$cssResult$=!0,e!==lt)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){let t=ht.get(this.cssText);return ut&&void 0===t&&(ht.set(this.cssText,t=new CSSStyleSheet),t.replaceSync(this.cssText)),t}toString(){return this.cssText}}const dt=(t,...e)=>{const n=1===t.length?t[0]:e.reduce(((e,n,r)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[r+1]),t[0]);return new ft(n,lt)},pt=(t,e)=>{ut?t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):e.forEach((e=>{const n=document.createElement("style");n.textContent=e.cssText,t.appendChild(n)}))},yt=ut?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return(t=>new ft("string"==typeof t?t:t+"",lt))(e)})(t):t,vt=(gt=t=>class extends t{static get scopedElements(){return{}}static get shadowRootOptions(){return this.__shadowRootOptions}static set shadowRootOptions(t){this.__shadowRootOptions=t}static get elementStyles(){return this.__elementStyles}static set elementStyles(t){this.__elementStyles=t}constructor(...t){super(),this.renderOptions=this.renderOptions||void 0}get registry(){return this.constructor.__registry}set registry(t){this.constructor.__registry=t}createRenderRoot(){const{scopedElements:t,shadowRootOptions:e,elementStyles:n}=this.constructor;this.registry||(this.registry=new CustomElementRegistry,Object.entries(t).forEach((([t,e])=>this.registry.define(t,e))));const r={mode:"open",...e,customElements:this.registry};return this.renderOptions.creationScope=this.attachShadow(r),this.renderOptions.creationScope instanceof ShadowRoot&&pt(this.renderOptions.creationScope,n),this.renderOptions.creationScope}defineScopedElement(t,e){return this.registry.get(t)||this.registry.define(t,e)}getScopedTagName(t){return t}static getScopedTagName(t){return t}},t=>{if(function(t,e){let n=e;for(;n;){if(ct.get(n)===t)return!0;n=Object.getPrototypeOf(n)}return!1}(gt,t))return t;const e=gt(t);return ct.set(e,gt),e});var gt,mt,bt,wt,_t;const xt={toAttribute(t,e){switch(e){case Boolean:t=t?"":null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},St=(t,e)=>e!==t&&(e==e||t==t),Et={attribute:!0,type:String,converter:xt,reflect:!1,hasChanged:St};class Ct extends HTMLElement{constructor(){super(),this._$Et=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Ei=null,this.o()}static addInitializer(t){var e;null!==(e=this.l)&&void 0!==e||(this.l=[]),this.l.push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,n)=>{const r=this._$Eh(n,e);void 0!==r&&(this._$Eu.set(r,n),t.push(r))})),t}static createProperty(t,e=Et){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,r=this.getPropertyDescriptor(t,n,e);void 0!==r&&Object.defineProperty(this.prototype,t,r)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(r){const i=this[t];this[e]=r,this.requestUpdate(t,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||Et}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),this.elementProperties=new Map(t.elementProperties),this._$Eu=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(yt(t))}else void 0!==t&&e.push(yt(t));return e}static _$Eh(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}o(){var t;this._$Ev=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$Ep(),this.requestUpdate(),null===(t=this.constructor.l)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,n;(null!==(e=this._$Em)&&void 0!==e?e:this._$Em=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$Em)||void 0===e||e.splice(this._$Em.indexOf(t)>>>0,1)}_$Ep(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this._$Et.set(e,this[e]),delete this[e])}))}createRenderRoot(){var t;const e=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return pt(e,this.constructor.elementStyles),e}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$Em)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)}))}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$Em)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)}))}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$Eg(t,e,n=Et){var r,i;const o=this.constructor._$Eh(t,n);if(void 0!==o&&!0===n.reflect){const s=(null!==(i=null===(r=n.converter)||void 0===r?void 0:r.toAttribute)&&void 0!==i?i:xt.toAttribute)(e,n.type);this._$Ei=t,null==s?this.removeAttribute(o):this.setAttribute(o,s),this._$Ei=null}}_$AK(t,e){var n,r,i;const o=this.constructor,s=o._$Eu.get(t);if(void 0!==s&&this._$Ei!==s){const t=o.getPropertyOptions(s),a=t.converter,c=null!==(i=null!==(r=null===(n=a)||void 0===n?void 0:n.fromAttribute)&&void 0!==r?r:"function"==typeof a?a:null)&&void 0!==i?i:xt.fromAttribute;this._$Ei=s,this[s]=c(e,t.type),this._$Ei=null}}requestUpdate(t,e,n){let r=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||St)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$Ei!==t&&(void 0===this._$ES&&(this._$ES=new Map),this._$ES.set(t,n))):r=!1),!this.isUpdatePending&&r&&(this._$Ev=this._$EC())}async _$EC(){this.isUpdatePending=!0;try{await this._$Ev}catch(t){Promise.reject(t)}const t=this.performUpdate();return null!=t&&await t,!this.isUpdatePending}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Et&&(this._$Et.forEach(((t,e)=>this[e]=t)),this._$Et=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$Em)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(n)):this._$E_()}catch(t){throw e=!1,this._$E_(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$Em)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$E_(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$Ev}shouldUpdate(t){return!0}update(t){void 0!==this._$ES&&(this._$ES.forEach(((t,e)=>this._$Eg(e,this[e],t))),this._$ES=void 0),this._$E_()}updated(t){}firstUpdated(t){}}
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
var kt,$t,Ut,At;Ct.finalized=!0,Ct.elementProperties=new Map,Ct.elementStyles=[],Ct.shadowRootOptions={mode:"open"},null===(bt=(mt=globalThis).reactiveElementPlatformSupport)||void 0===bt||bt.call(mt,{ReactiveElement:Ct}),(null!==(wt=(_t=globalThis).reactiveElementVersions)&&void 0!==wt?wt:_t.reactiveElementVersions=[]).push("1.0.0-rc.3");const jt=globalThis.trustedTypes,Ot=jt?jt.createPolicy("lit-html",{createHTML:t=>t}):void 0,It=`lit$${(Math.random()+"").slice(9)}$`,Tt="?"+It,Pt=`<${Tt}>`,Lt=document,Bt=(t="")=>Lt.createComment(t),Rt=t=>null===t||"object"!=typeof t&&"function"!=typeof t,Mt=Array.isArray,Dt=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,zt=/-->/g,Ht=/>/g,Ft=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,qt=/'/g,Nt=/"/g,Wt=/^(?:script|style|textarea)$/i,Vt=(t=>(e,...n)=>({_$litType$:t,strings:e,values:n}))(1),Kt=Symbol.for("lit-noChange"),Zt=Symbol.for("lit-nothing"),Gt=new WeakMap,Xt=Lt.createTreeWalker(Lt,129,null,!1);class Jt{constructor({strings:t,_$litType$:e},n){let r;this.parts=[];let i=0,o=0;const s=t.length-1,a=this.parts,[c,u]=((t,e)=>{const n=t.length-1,r=[];let i,o=2===e?"<svg>":"",s=Dt;for(let e=0;e<n;e++){const n=t[e];let a,c,u=-1,l=0;for(;l<n.length&&(s.lastIndex=l,c=s.exec(n),null!==c);)l=s.lastIndex,s===Dt?"!--"===c[1]?s=zt:void 0!==c[1]?s=Ht:void 0!==c[2]?(Wt.test(c[2])&&(i=RegExp("</"+c[2],"g")),s=Ft):void 0!==c[3]&&(s=Ft):s===Ft?">"===c[0]?(s=null!=i?i:Dt,u=-1):void 0===c[1]?u=-2:(u=s.lastIndex-c[2].length,a=c[1],s=void 0===c[3]?Ft:'"'===c[3]?Nt:qt):s===Nt||s===qt?s=Ft:s===zt||s===Ht?s=Dt:(s=Ft,i=void 0);const h=s===Ft&&t[e+1].startsWith("/>")?" ":"";o+=s===Dt?n+Pt:u>=0?(r.push(a),n.slice(0,u)+"$lit$"+n.slice(u)+It+h):n+It+(-2===u?(r.push(void 0),e):h)}const a=o+(t[n]||"<?>")+(2===e?"</svg>":"");return[void 0!==Ot?Ot.createHTML(a):a,r]})(t,e);if(this.el=Jt.createElement(c,n),Xt.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(r=Xt.nextNode())&&a.length<s;){if(1===r.nodeType){if(r.hasAttributes()){const t=[];for(const e of r.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(It)){const n=u[o++];if(t.push(e),void 0!==n){const t=r.getAttribute(n.toLowerCase()+"$lit$").split(It),e=/([.?@])?(.*)/.exec(n);a.push({type:1,index:i,name:e[2],strings:t,ctor:"."===e[1]?ne:"?"===e[1]?re:"@"===e[1]?ie:ee})}else a.push({type:6,index:i})}for(const e of t)r.removeAttribute(e)}if(Wt.test(r.tagName)){const t=r.textContent.split(It),e=t.length-1;if(e>0){r.textContent=jt?jt.emptyScript:"";for(let n=0;n<e;n++)r.append(t[n],Bt()),Xt.nextNode(),a.push({type:2,index:++i});r.append(t[e],Bt())}}}else if(8===r.nodeType)if(r.data===Tt)a.push({type:2,index:i});else{let t=-1;for(;-1!==(t=r.data.indexOf(It,t+1));)a.push({type:7,index:i}),t+=It.length-1}i++}}static createElement(t,e){const n=Lt.createElement("template");return n.innerHTML=t,n}}function Yt(t,e,n=t,r){var i,o,s,a;if(e===Kt)return e;let c=void 0!==r?null===(i=n._$Cl)||void 0===i?void 0:i[r]:n._$Cu;const u=Rt(e)?void 0:e._$litDirective$;return(null==c?void 0:c.constructor)!==u&&(null===(o=null==c?void 0:c._$AO)||void 0===o||o.call(c,!1),void 0===u?c=void 0:(c=new u(t),c._$AT(t,n,r)),void 0!==r?(null!==(s=(a=n)._$Cl)&&void 0!==s?s:a._$Cl=[])[r]=c:n._$Cu=c),void 0!==c&&(e=Yt(t,c._$AS(t,e.values),c,r)),e}class Qt{constructor(t,e){this.v=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get _$AU(){return this._$AM._$AU}p(t){var e;const{el:{content:n},parts:r}=this._$AD,i=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:Lt).importNode(n,!0);Xt.currentNode=i;let o=Xt.nextNode(),s=0,a=0,c=r[0];for(;void 0!==c;){if(s===c.index){let e;2===c.type?e=new te(o,o.nextSibling,this,t):1===c.type?e=new c.ctor(o,c.name,c.strings,this,t):6===c.type&&(e=new oe(o,this,t)),this.v.push(e),c=r[++a]}s!==(null==c?void 0:c.index)&&(o=Xt.nextNode(),s++)}return i}m(t){let e=0;for(const n of this.v)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class te{constructor(t,e,n,r){this.type=2,this._$C_=!0,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=r}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$C_}get parentNode(){return this._$AA.parentNode}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=Yt(this,t,e),Rt(t)?t===Zt||null==t||""===t?(this._$AH!==Zt&&this._$AR(),this._$AH=Zt):t!==this._$AH&&t!==Kt&&this.$(t):void 0!==t._$litType$?this.T(t):void 0!==t.nodeType?this.A(t):(t=>{var e;return Mt(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.M(t):this.$(t)}C(t,e=this._$AB){return this._$AA.parentNode.insertBefore(t,e)}A(t){this._$AH!==t&&(this._$AR(),this._$AH=this.C(t))}$(t){const e=this._$AA.nextSibling;null!==e&&3===e.nodeType&&(null===this._$AB?null===e.nextSibling:e===this._$AB.previousSibling)?e.data=t:this.A(Lt.createTextNode(t)),this._$AH=t}T(t){var e;const{values:n,_$litType$:r}=t,i="number"==typeof r?this._$AC(t):(void 0===r.el&&(r.el=Jt.createElement(r.h,this.options)),r);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===i)this._$AH.m(n);else{const t=new Qt(i,this),e=t.p(this.options);t.m(n),this.A(e),this._$AH=t}}_$AC(t){let e=Gt.get(t.strings);return void 0===e&&Gt.set(t.strings,e=new Jt(t)),e}M(t){Mt(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,r=0;for(const i of t)r===e.length?e.push(n=new te(this.C(Bt()),this.C(Bt()),this,this.options)):n=e[r],n._$AI(i),r++;r<e.length&&(this._$AR(n&&n._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$C_=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class ee{constructor(t,e,n,r,i){this.type=1,this._$AH=Zt,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(Zt),this.strings=n):this._$AH=Zt}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,r){const i=this.strings;let o=!1;if(void 0===i)t=Yt(this,t,e,0),o=!Rt(t)||t!==this._$AH&&t!==Kt,o&&(this._$AH=t);else{const r=t;let s,a;for(t=i[0],s=0;s<i.length-1;s++)a=Yt(this,r[n+s],e,s),a===Kt&&(a=this._$AH[s]),o||(o=!Rt(a)||a!==this._$AH[s]),a===Zt?t=Zt:t!==Zt&&(t+=(null!=a?a:"")+i[s+1]),this._$AH[s]=a}o&&!r&&this.P(t)}P(t){t===Zt?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class ne extends ee{constructor(){super(...arguments),this.type=3}P(t){this.element[this.name]=t===Zt?void 0:t}}class re extends ee{constructor(){super(...arguments),this.type=4}P(t){t&&t!==Zt?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class ie extends ee{constructor(){super(...arguments),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=Yt(this,t,e,0))&&void 0!==n?n:Zt)===Kt)return;const r=this._$AH,i=t===Zt&&r!==Zt||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,o=t!==Zt&&(r===Zt||i);i&&this.element.removeEventListener(this.name,this,r),o&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}}class oe{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){Yt(this,t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
var se,ae,ce,ue,le,he;null===($t=(kt=globalThis).litHtmlPlatformSupport)||void 0===$t||$t.call(kt,Jt,te),(null!==(Ut=(At=globalThis).litHtmlVersions)&&void 0!==Ut?Ut:At.litHtmlVersions=[]).push("2.0.0-rc.4");class fe extends Ct{constructor(){super(...arguments),this.renderOptions={host:this},this._$Dt=void 0}createRenderRoot(){var t,e;const n=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=n.firstChild),n}update(t){const e=this.render();super.update(t),this._$Dt=((t,e,n)=>{var r,i;const o=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:e;let s=o._$litPart$;if(void 0===s){const t=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:null;o._$litPart$=s=new te(e.insertBefore(Bt(),t),t,void 0,null!=n?n:{})}return s._$AI(t),s})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Dt)||void 0===t||t.setConnected(!1)}render(){return Kt}}fe.finalized=!0,fe._$litElement$=!0,null===(ae=(se=globalThis).litElementHydrateSupport)||void 0===ae||ae.call(se,{LitElement:fe}),null===(ue=(ce=globalThis).litElementPlatformSupport)||void 0===ue||ue.call(ce,{LitElement:fe}),(null!==(le=(he=globalThis).litElementVersions)&&void 0!==le?le:he.litElementVersions=[]).push("3.0.0-rc.3");
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
const de=(t,e)=>"method"===e.kind&&e.descriptor&&!("value"in e.descriptor)?{...e,finisher(n){n.createProperty(e.key,t)}}:{kind:"field",key:Symbol(),placement:"own",descriptor:{},originalKey:e.key,initializer(){"function"==typeof e.initializer&&(this[e.key]=e.initializer.call(this))},finisher(n){n.createProperty(e.key,t)}};function pe(t){return(e,n)=>void 0!==n?((t,e,n)=>{e.constructor.createProperty(n,t)})(t,e,n):de(t,e)
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */}function ye(t){return pe({...t,state:!0})}
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
/**
     * @license
     * Copyright 2021 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
class ve extends Event{constructor(t,e,n){super("context-request",{bubbles:!0,composed:!0}),this.context=t,this.callback=e,this.multiple=n}}
/**
     * @license
     * Copyright 2021 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */function ge(t,e){return{name:t,initialValue:e}}
/**
     * @license
     * Copyright 2017 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */const me=1,be=6,we=t=>(...e)=>({_$litDirective$:t,values:e});class _e{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,n){this._$Ct=t,this._$AM=e,this._$Ci=n}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}
/**
     * @license
     * Copyright 2021 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */class xe{constructor(t){this.callbacks=new Set,this.updateContext=()=>{this.callbacks.forEach((([t,e])=>t(this.o,e)))},void 0!==t&&(this.value=t)}get value(){return this.o}set value(t){this.setValue(t)}setValue(t,e=!1){let n=!1;t!==this.o&&(n=!0),this.o=t,(n||e)&&this.updateContext()}addCallback(t,e){if(e){const e=[t,()=>{this.callbacks.delete(e)}];this.callbacks.add(e)}t(this.value)}clearCallbacks(){this.callbacks.clear()}}const Se=we(class extends _e{constructor(t){if(super(t),this.onContextRequest=t=>{var e;t.context===this.i&&(t.stopPropagation(),null===(e=this.t)||void 0===e||e.addCallback(t.callback,t.multiple))},t.type!==be)throw Error("The `provide` directive is only allowed on element bindings")}render(t,e){return Kt}update(t,[e,n]){const r=this.render(e,n),i=t.element;return void 0===this.t&&(this.t=new xe(n)),this.l!==i&&(this.l&&this.l.removeEventListener("context-request",this.onContextRequest),this.l=i),this.i=e,this.t.value=n,null==i||i.addEventListener("context-request",this.onContextRequest),r}});
/**
     * @license
     * Copyright 2021 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */class Ee{constructor(t,e,n,r=!1){this.host=t,this.context=e,this.callback=n,this.multiple=r,this.provided=!1,this.host.addController(this)}hostConnected(){setTimeout((()=>{this.host.dispatchEvent(new ve(this.context,((t,e)=>{this.dispose&&(this.dispose!==e&&this.dispose(),this.multiple||this.dispose()),this.provided&&!this.multiple||(this.provided=!0,this.callback(t,e)),this.dispose=e}),this.multiple))}))}hostDisconnected(){this.dispose&&(this.dispose(),this.dispose=void 0)}}
/**
     * @license
     * Copyright 2021 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */function Ce({context:t,multiple:e}){return(({finisher:t,descriptor:e})=>(n,r)=>{var i;if(void 0===r){const r=null!==(i=n.originalKey)&&void 0!==i?i:n.key,o=null!=e?{kind:"method",placement:"prototype",key:r,descriptor:e(n.key)}:{...n,key:r};return null!=t&&(o.finisher=function(e){t(e,r)}),o}{const i=n.constructor;void 0!==e&&Object.defineProperty(n,r,e(r)),null==t||t(i,r)}})({finisher:(n,r)=>{n.addInitializer((n=>{n.addController(new Ee(n,t,(t=>{n[r]=t}),e))}))}})}class ke{constructor(t,e,n){this.host=t,this.store=e,this.callback=n,t.addController(this)}hostConnected(){this._unsubscribe=this.store.subscribe((t=>{this.value=t,this.callback&&this.callback(t),this.host.requestUpdate()}))}hostDisconnected(){this._unsubscribe()}}class $e{constructor(t,e){this.host=t,this.getStore=e,t.addController(this)}hostConnected(){this.resubscribe()}hostUpdate(){this.resubscribe()}hostDisconnected(){this._unsubscribe()}resubscribe(){const t=this.getStore();t!==this._previousStore&&(this._unsubscribe&&this._unsubscribe(),t&&(this._unsubscribe=t.subscribe((t=>{this.value=t,this.host.requestUpdate()})))),this._previousStore=t}}const Ue=ge("syn-context",void 0),Ae=ge("syn-session-context",void 0);var je=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};class Oe extends(vt(fe)){render(){var t;return Vt`
    <slot
      ${Se(Ae,null===(t=this.synStore)||void 0===t?void 0:t.sessionStore(this.sessionHash))}
    ></slot>`}static get styles(){return dt`
      :host {
        display: contents;
      }
    `}}je([pe({attribute:"session-hash"})],Oe.prototype,"sessionHash",void 0),je([Ce({context:Ue,multiple:!0}),ye()],Oe.prototype,"synStore",void 0);var Ie=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};class Te extends(vt(fe)){updated(t){super.updated(t),t.has("store")&&(this._activeSession=new ke(this,this.store.activeSession))}render(){var t,e;return Vt`
      <syn-session
        .sessionHash=${null===(e=null===(t=this._activeSession)||void 0===t?void 0:t.value)||void 0===e?void 0:e.hash}
        ${Se(Ue,this.store)}
      >
        <slot></slot>
      </syn-session>
    `}static get styles(){return dt`
      :host {
        display: contents;
      }
    `}static get scopedElements(){return{"syn-session":Oe}}}Ie([pe()],Te.prototype,"store",void 0);
/**
     * @license
     * Copyright 2018 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */
const Pe=we(class extends _e{constructor(t){var e;if(super(t),t.type!==me||"style"!==t.name||(null===(e=t.strings)||void 0===e?void 0:e.length)>2)throw Error("The `styleMap` directive must be used in the `style` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).reduce(((e,n)=>{const r=t[n];return null==r?e:e+`${n=n.replace(/(?:^(webkit|moz|ms|o)|)(?=[A-Z])/g,"-$&").toLowerCase()}:${r};`}),"")}update(t,[e]){const{style:n}=t.element;if(void 0===this.ct){this.ct=new Set;for(const t in e)this.ct.add(t);return this.render(e)}this.ct.forEach((t=>{null==e[t]&&(this.ct.delete(t),t.includes("-")?n.removeProperty(t):n[t]="")}));for(const t in e){const r=e[t];null!=r&&(this.ct.add(t),t.includes("-")?n.setProperty(t,r):n[t]=r)}return Kt}}),Le=we(class extends _e{constructor(t){var e;if(super(t),t.type!==me||"class"!==t.name||(null===(e=t.strings)||void 0===e?void 0:e.length)>2)throw Error("`classMap()` can only be used in the `class` attribute and must be the only part in the attribute.")}render(t){return Object.keys(t).filter((e=>t[e])).join(" ")}update(t,[e]){if(void 0===this.st){this.st=new Set;for(const t in e)e[t]&&this.st.add(t);return this.render(e)}const n=t.element.classList;this.st.forEach((t=>{t in e||(n.remove(t),this.st.delete(t))}));for(const t in e){const r=!!e[t];r!==this.st.has(t)&&(r?(n.add(t),this.st.add(t)):(n.remove(t),this.st.delete(t)))}return Kt}});
/**
     * @license
     * Copyright 2018 Google LLC
     * SPDX-License-Identifier: BSD-3-Clause
     */function Be(t){const[e,n,r]=t;return`hsl(${e} ${n}% ${r}%)`}var Re=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};class Me extends(vt(fe)){constructor(){super(...arguments),this.isScribe=!1}render(){return Vt`
      <div class=${Le({"scribe-wrapper":this.isScribe})}>
        <div
          class=${Le({folk:!0,scribe:this.isScribe,"out-of-session":this.folk.inSession})}
          class="folk scribe"
          class:me
          class:out-of-session="{outOfSession}"
          style=${Pe({"background-color":Be(this.folk.colors.primary)})}
        >
          <div
            class="folk-color"
            style=${Pe({"background-color":Be(this.folk.colors.hexagon)})}
          ></div>
          ${this.pubKey.slice(-4)}
        </div>
        ${this.isScribe?Vt` <div class="scribe-halo"></div> `:Vt``}
      </div>
    `}static get styles(){return dt`
      :host {
        --folk-hex-width: 60px;
        --folk-hex-height: calc(var(--folk-hex-width) * 0.8666);
        --hex-border: 4px;
        --scribe-hex-width: calc(var(--folk-hex-width) - 2 * var(--hex-border));
        --scribe-hex-height: calc(
          var(--folk-hex-height) - 2 * var(--hex-border)
        );
        --scribe-scale: 0.8666;
      }
      .folk {
        display: grid;
        width: var(--folk-hex-width);
        height: var(--folk-hex-height);
        clip-path: polygon(
          25% 0%,
          75% 0%,
          100% 50%,
          75% 100%,
          25% 100%,
          0% 50%
        );
        place-items: center;
        color: white;
        text-shadow: 0 0 5px black;
        cursor: pointer;
      }
      .folk-color {
        z-index: -10;
        content: '';
        width: calc(var(--folk-hex-width) - (var(--hex-border)) * 2);
        height: calc(var(--folk-hex-height) - (var(--hex-border)) * 2);
        clip-path: polygon(
          25% 0%,
          75% 0%,
          100% 50%,
          75% 100%,
          25% 100%,
          0% 50%
        );
        position: absolute;
      }

      .scribe-wrapper {
        display: grid;
        position: relative;
        place-items: center;
      }
      .scribe-halo {
        width: var(--folk-hex-width);
        height: var(--folk-hex-height);
        /* https://www.desmos.com/calculator/bgt97otugr */
        clip-path: polygon(
          25%0%,
          75%0%,
          100%50%,
          75%100%,
          25%100%,
          12.5% 75%,
          calc(12.5% + 1.732px) calc(75% - 1px),
          calc(25% + 1.15px) calc(100% - 2px),
          50% calc(100% - 2px),
          50% 100%,
          75% 100%,
          87.5% 75%,
          calc(87.5% - 1.732px) calc(75% - 1px),
          calc(100% - 2.31px) 50%,
          calc(87.5% - 1.732px) calc(25% + 1px),
          87.5% 25%,
          75%0%,
          50%0%,
          50% calc(0% + 2px),
          calc(25% + 1.15px) calc(0% + 2px),
          calc(12.5% + 1.732px) calc(25% + 1px),
          12.5% 25%
        );
        background-color: hsl(0, 0%, 10%);
        position: absolute;
      }
      .scribe {
        margin: var(--hex-border) 0;
        scale: var(--scribe-scale);
      }

      .out-of-session {
        /* folk hex outline */
        background-color: goldenrod !important;
      }
      .out-of-session div {
        /* folk-color */
        background-color: goldenrodyellow !important;
        /* FIXME: this should grey out the hex instead of make it yellow :)*/
      }
    `}}Re([pe()],Me.prototype,"pubKey",void 0),Re([pe()],Me.prototype,"folk",void 0),Re([pe({attribute:"is-scribe"})],Me.prototype,"isScribe",void 0);const De=dt`
  .row {
    display: flex;
    flex-direction: row;
  }
  .column {
    display: flex;
    flex-direction: column;
  }
`;var ze,He,Fe,qe,Ne,We=function(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s};class Ve extends(vt(fe)){constructor(){super(...arguments),this._folks=new $e(this,(()=>{var t;return null===(t=this.session)||void 0===t?void 0:t.folks}))}render(){return this.session&&this._folks.value?Vt`
      <div class="column">
        <syn-folk
          .pubKey=${this.syn.myPubKey}
          .folk=${{colors:this.syn.myColors,inSession:!0,lastSeen:Date.now()}}
        ></syn-folk>
        ${Object.entries(this._folks.value).map((([t,e])=>Vt`<syn-folk
              .pubKey=${t}
              .folk=${e}
              .isScribe=${this.session.info.scribe===t}
            ></syn-folk>`))}
      </div>
    `:Vt`<span>There is no active session</span>`}static get scopedElements(){return{"syn-folk":Me}}static get styles(){return De}}We([Ce({context:Ue,multiple:!0}),ye()],Ve.prototype,"syn",void 0),We([Ce({context:Ae,multiple:!0}),ye()],Ve.prototype,"session",void 0),function(t){t.Dna="Dna",t.AgentValidationPkg="AgentValidationPkg",t.InitZomesComplete="InitZomesComplete",t.CreateLink="CreateLink",t.DeleteLink="DeleteLink",t.OpenChain="OpenChain",t.CloseChain="CloseChain",t.Create="Create",t.Update="Update",t.Delete="Delete"}(ze||(ze={})),function(t){t.StoreElement="StoreElement",t.StoreEntry="StoreEntry",t.RegisterAgentActivity="RegisterAgentActivity",t.RegisterUpdatedContent="RegisterUpdatedContent",t.RegisterUpdatedElement="RegisterUpdatedElement",t.RegisterDeletedBy="RegisterDeletedBy",t.RegisterDeletedEntryHeader="RegisterDeletedEntryHeader",t.RegisterAddLink="RegisterAddLink",t.RegisterRemoveLink="RegisterRemoveLink"}(He||(He={})),He.RegisterAgentActivity,He.StoreEntry,He.StoreElement,He.RegisterUpdatedContent,He.RegisterUpdatedElement,He.RegisterDeletedEntryHeader,He.RegisterDeletedBy,He.RegisterAddLink,He.RegisterRemoveLink,function(t){t[t.Entry=0]="Entry",t[t.Element=1]="Element"}(Fe||(Fe={})),function(t){t[t.Empty=0]="Empty",t[t.Valid=1]="Valid",t[t.Forked=2]="Forked",t[t.Invalid=3]="Invalid"}(qe||(qe={})),function(t){t[t.Live=0]="Live",t[t.Dead=1]="Dead",t[t.Pending=2]="Pending",t[t.Rejected=3]="Rejected",t[t.Abandoned=4]="Abandoned",t[t.Conflict=5]="Conflict",t[t.Withdrawn=6]="Withdrawn",t[t.Purged=7]="Purged"}(Ne||(Ne={}));const Ke="function"==typeof btoa,Ze="function"==typeof Buffer,Ge=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="]),Xe=((t=>{let e={};t.forEach(((t,n)=>e[t]=n))})(Ge),String.fromCharCode.bind(String)),Je=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),t=>t.replace(/[+\/]/g,(t=>"+"==t?"-":"_")).replace(/=+$/m,"")),Ye=t=>{let e,n,r,i,o="";const s=t.length%3;for(let s=0;s<t.length;){if((n=t.charCodeAt(s++))>255||(r=t.charCodeAt(s++))>255||(i=t.charCodeAt(s++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|i,o+=Ge[e>>18&63]+Ge[e>>12&63]+Ge[e>>6&63]+Ge[63&e]}return s?o.slice(0,s-3)+"===".substring(s):o},Qe=Ke?t=>btoa(t):Ze?t=>Buffer.from(t,"binary").toString("base64"):Ye,tn=Ze?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let n=0,r=t.length;n<r;n+=4096)e.push(Xe.apply(null,t.subarray(n,n+4096)));return Qe(e.join(""))},en=(t,e=!1)=>e?Je(tn(t)):tn(t),nn=en;var rn;!function(t){t[t.Valid=0]="Valid",t[t.Rejected=1]="Rejected",t[t.Abandoned=2]="Abandoned"}(rn||(rn={}));var on=4294967295;function sn(t,e,n){var r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function an(t,e){return 4294967296*t.getInt32(e)+t.getUint32(e+4)}var cn=("undefined"==typeof process||"never"!==process.env.TEXT_ENCODING)&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function un(t){for(var e=t.length,n=0,r=0;r<e;){var i=t.charCodeAt(r++);if(0!=(4294967168&i))if(0==(4294965248&i))n+=2;else{if(i>=55296&&i<=56319&&r<e){var o=t.charCodeAt(r);56320==(64512&o)&&(++r,i=((1023&i)<<10)+(1023&o)+65536)}n+=0==(4294901760&i)?3:4}else n++}return n}var ln=cn?new TextEncoder:void 0,hn=cn?"undefined"!=typeof process&&"force"!==process.env.TEXT_ENCODING?200:0:on;var fn=(null==ln?void 0:ln.encodeInto)?function(t,e,n){ln.encodeInto(t,e.subarray(n))}:function(t,e,n){e.set(ln.encode(t),n)};function dn(t,e,n){for(var r=e,i=r+n,o=[],s="";r<i;){var a=t[r++];if(0==(128&a))o.push(a);else if(192==(224&a)){var c=63&t[r++];o.push((31&a)<<6|c)}else if(224==(240&a)){c=63&t[r++];var u=63&t[r++];o.push((31&a)<<12|c<<6|u)}else if(240==(248&a)){var l=(7&a)<<18|(c=63&t[r++])<<12|(u=63&t[r++])<<6|63&t[r++];l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l)}else o.push(a);o.length>=4096&&(s+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(s+=String.fromCharCode.apply(String,o)),s}var pn=cn?new TextDecoder:null,yn=cn?"undefined"!=typeof process&&"force"!==process.env.TEXT_DECODER?200:0:on;var vn,gn=function(t,e){this.type=t,this.data=e},mn=(vn=function(t,e){return(vn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}vn(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),bn=function(t){function e(n){var r=t.call(this,n)||this,i=Object.create(e.prototype);return Object.setPrototypeOf(r,i),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name}),r}return mn(e,t),e}(Error);var wn={type:-1,encode:function(t){var e,n,r,i;return t instanceof Date?function(t){var e,n=t.sec,r=t.nsec;if(n>=0&&r>=0&&n<=17179869183){if(0===r&&n<=4294967295){var i=new Uint8Array(4);return(e=new DataView(i.buffer)).setUint32(0,n),i}var o=n/4294967296,s=4294967295&n;return i=new Uint8Array(8),(e=new DataView(i.buffer)).setUint32(0,r<<2|3&o),e.setUint32(4,s),i}return i=new Uint8Array(12),(e=new DataView(i.buffer)).setUint32(0,r),sn(e,4,n),i}((e=t.getTime(),n=Math.floor(e/1e3),r=1e6*(e-1e3*n),i=Math.floor(r/1e9),{sec:n+i,nsec:r-1e9*i})):null},decode:function(t){var e=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:var n=e.getUint32(0);return{sec:4294967296*(3&n)+e.getUint32(4),nsec:n>>>2};case 12:return{sec:an(e,4),nsec:e.getUint32(0)};default:throw new bn("Unrecognized data size for timestamp (expected 4, 8, or 12): "+t.length)}}(t);return new Date(1e3*e.sec+e.nsec/1e6)}},_n=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(wn)}return t.prototype.register=function(t){var e=t.type,n=t.encode,r=t.decode;if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{var i=1+e;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}},t.prototype.tryToEncode=function(t,e){for(var n=0;n<this.builtInEncoders.length;n++){if(null!=(r=this.builtInEncoders[n]))if(null!=(i=r(t,e)))return new gn(-1-n,i)}for(n=0;n<this.encoders.length;n++){var r,i;if(null!=(r=this.encoders[n]))if(null!=(i=r(t,e)))return new gn(n,i)}return t instanceof gn?t:null},t.prototype.decode=function(t,e,n){var r=e<0?this.builtInDecoders[-1-e]:this.decoders[e];return r?r(t,e,n):new gn(e,t)},t.defaultCodec=new t,t}();function xn(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}var Sn=function(){function t(t,e,n,r,i,o,s,a){void 0===t&&(t=_n.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=100),void 0===r&&(r=2048),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),this.extensionCodec=t,this.context=e,this.maxDepth=n,this.initialBufferSize=r,this.sortKeys=i,this.forceFloat32=o,this.ignoreUndefined=s,this.forceIntegerToFloat=a,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encode=function(t){return this.reinitializeState(),this.doEncode(t,1),this.getUint8Array()},t.prototype.doEncode=function(t,e){if(e>this.maxDepth)throw new Error("Too deep objects in depth "+e);null==t?this.encodeNil():"boolean"==typeof t?this.encodeBoolean(t):"number"==typeof t?this.encodeNumber(t):"string"==typeof t?this.encodeString(t):this.encodeObject(t,e)},t.prototype.ensureBufferSizeToWrite=function(t){var e=this.pos+t;this.view.byteLength<e&&this.resizeBuffer(2*e)},t.prototype.resizeBuffer=function(t){var e=new ArrayBuffer(t),n=new Uint8Array(e),r=new DataView(e);n.set(this.bytes),this.view=r,this.bytes=n},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(t){!1===t?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(t){Number.isSafeInteger(t)&&!this.forceIntegerToFloat?t>=0?t<128?this.writeU8(t):t<256?(this.writeU8(204),this.writeU8(t)):t<65536?(this.writeU8(205),this.writeU16(t)):t<4294967296?(this.writeU8(206),this.writeU32(t)):(this.writeU8(207),this.writeU64(t)):t>=-32?this.writeU8(224|t+32):t>=-128?(this.writeU8(208),this.writeI8(t)):t>=-32768?(this.writeU8(209),this.writeI16(t)):t>=-2147483648?(this.writeU8(210),this.writeI32(t)):(this.writeU8(211),this.writeI64(t)):this.forceFloat32?(this.writeU8(202),this.writeF32(t)):(this.writeU8(203),this.writeF64(t))},t.prototype.writeStringHeader=function(t){if(t<32)this.writeU8(160+t);else if(t<256)this.writeU8(217),this.writeU8(t);else if(t<65536)this.writeU8(218),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too long string: "+t+" bytes in UTF-8");this.writeU8(219),this.writeU32(t)}},t.prototype.encodeString=function(t){if(t.length>hn){var e=un(t);this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),fn(t,this.bytes,this.pos),this.pos+=e}else{e=un(t);this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),function(t,e,n){for(var r=t.length,i=n,o=0;o<r;){var s=t.charCodeAt(o++);if(0!=(4294967168&s)){if(0==(4294965248&s))e[i++]=s>>6&31|192;else{if(s>=55296&&s<=56319&&o<r){var a=t.charCodeAt(o);56320==(64512&a)&&(++o,s=((1023&s)<<10)+(1023&a)+65536)}0==(4294901760&s)?(e[i++]=s>>12&15|224,e[i++]=s>>6&63|128):(e[i++]=s>>18&7|240,e[i++]=s>>12&63|128,e[i++]=s>>6&63|128)}e[i++]=63&s|128}else e[i++]=s}}(t,this.bytes,this.pos),this.pos+=e}},t.prototype.encodeObject=function(t,e){var n=this.extensionCodec.tryToEncode(t,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(t))this.encodeArray(t,e);else if(ArrayBuffer.isView(t))this.encodeBinary(t);else{if("object"!=typeof t)throw new Error("Unrecognized object: "+Object.prototype.toString.apply(t));this.encodeMap(t,e)}},t.prototype.encodeBinary=function(t){var e=t.byteLength;if(e<256)this.writeU8(196),this.writeU8(e);else if(e<65536)this.writeU8(197),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large binary: "+e);this.writeU8(198),this.writeU32(e)}var n=xn(t);this.writeU8a(n)},t.prototype.encodeArray=function(t,e){var n=t.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else{if(!(n<4294967296))throw new Error("Too large array: "+n);this.writeU8(221),this.writeU32(n)}for(var r=0,i=t;r<i.length;r++){var o=i[r];this.doEncode(o,e+1)}},t.prototype.countWithoutUndefined=function(t,e){for(var n=0,r=0,i=e;r<i.length;r++){void 0!==t[i[r]]&&n++}return n},t.prototype.encodeMap=function(t,e){var n=Object.keys(t);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(t,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large map object: "+r);this.writeU8(223),this.writeU32(r)}for(var i=0,o=n;i<o.length;i++){var s=o[i],a=t[s];this.ignoreUndefined&&void 0===a||(this.encodeString(s),this.doEncode(a,e+1))}},t.prototype.encodeExtension=function(t){var e=t.data.length;if(1===e)this.writeU8(212);else if(2===e)this.writeU8(213);else if(4===e)this.writeU8(214);else if(8===e)this.writeU8(215);else if(16===e)this.writeU8(216);else if(e<256)this.writeU8(199),this.writeU8(e);else if(e<65536)this.writeU8(200),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large extension object: "+e);this.writeU8(201),this.writeU32(e)}this.writeI8(t.type),this.writeU8a(t.data)},t.prototype.writeU8=function(t){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,t),this.pos++},t.prototype.writeU8a=function(t){var e=t.length;this.ensureBufferSizeToWrite(e),this.bytes.set(t,this.pos),this.pos+=e},t.prototype.writeI8=function(t){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,t),this.pos++},t.prototype.writeU16=function(t){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,t),this.pos+=2},t.prototype.writeI16=function(t){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,t),this.pos+=2},t.prototype.writeU32=function(t){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,t),this.pos+=4},t.prototype.writeI32=function(t){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,t),this.pos+=4},t.prototype.writeF32=function(t){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,t),this.pos+=4},t.prototype.writeF64=function(t){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,t),this.pos+=8},t.prototype.writeU64=function(t){this.ensureBufferSizeToWrite(8),function(t,e,n){var r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}(this.view,this.pos,t),this.pos+=8},t.prototype.writeI64=function(t){this.ensureBufferSizeToWrite(8),sn(this.view,this.pos,t),this.pos+=8},t}(),En={};function Cn(t,e){return void 0===e&&(e=En),new Sn(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat).encode(t)}function kn(t){return(t<0?"-":"")+"0x"+Math.abs(t).toString(16).padStart(2,"0")}var $n=function(){function t(t,e){void 0===t&&(t=16),void 0===e&&(e=16),this.maxKeyLength=t,this.maxLengthPerKey=e,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return t.prototype.canBeCached=function(t){return t>0&&t<=this.maxKeyLength},t.prototype.find=function(t,e,n){t:for(var r=0,i=this.caches[n-1];r<i.length;r++){for(var o=i[r],s=o.bytes,a=0;a<n;a++)if(s[a]!==t[e+a])continue t;return o.str}return null},t.prototype.store=function(t,e){var n=this.caches[t.length-1],r={bytes:t,str:e};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},t.prototype.decode=function(t,e,n){var r=this.find(t,e,n);if(null!=r)return this.hit++,r;this.miss++;var i=dn(t,e,n),o=Uint8Array.prototype.slice.call(t,e,e+n);return this.store(o,i),i},t}(),Un=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},An=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},jn=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}},On=function(t){return this instanceof On?(this.v=t,this):new On(t)},In=function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||a(t,e)}))})}function a(t,e){try{!function(t){t.value instanceof On?Promise.resolve(t.value.v).then(c,u):l(o[0][2],t)}(i[t](e))}catch(t){l(o[0][3],t)}}function c(t){a("next",t)}function u(t){a("throw",t)}function l(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}},Tn=new DataView(new ArrayBuffer(0)),Pn=new Uint8Array(Tn.buffer),Ln=function(){try{Tn.getInt8(0)}catch(t){return t.constructor}throw new Error("never reached")}(),Bn=new Ln("Insufficient data"),Rn=new $n,Mn=function(){function t(t,e,n,r,i,o,s,a){void 0===t&&(t=_n.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=on),void 0===r&&(r=on),void 0===i&&(i=on),void 0===o&&(o=on),void 0===s&&(s=on),void 0===a&&(a=Rn),this.extensionCodec=t,this.context=e,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=i,this.maxMapLength=o,this.maxExtLength=s,this.keyDecoder=a,this.totalPos=0,this.pos=0,this.view=Tn,this.bytes=Pn,this.headByte=-1,this.stack=[]}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},t.prototype.setBuffer=function(t){this.bytes=xn(t),this.view=function(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=xn(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}(this.bytes),this.pos=0},t.prototype.appendBuffer=function(t){if(-1!==this.headByte||this.hasRemaining(1)){var e=this.bytes.subarray(this.pos),n=xn(t),r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),this.setBuffer(r)}else this.setBuffer(t)},t.prototype.hasRemaining=function(t){return this.view.byteLength-this.pos>=t},t.prototype.createExtraByteError=function(t){var e=this.view,n=this.pos;return new RangeError("Extra "+(e.byteLength-n)+" of "+e.byteLength+" byte(s) found at buffer["+t+"]")},t.prototype.decode=function(t){this.reinitializeState(),this.setBuffer(t);var e=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return e},t.prototype.decodeMulti=function(t){return An(this,(function(e){switch(e.label){case 0:this.reinitializeState(),this.setBuffer(t),e.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return e.sent(),[3,1];case 3:return[2]}}))},t.prototype.decodeAsync=function(t){var e,n,r,i;return Un(this,void 0,void 0,(function(){var o,s,a,c,u,l,h,f;return An(this,(function(d){switch(d.label){case 0:o=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),e=jn(t),d.label=2;case 2:return[4,e.next()];case 3:if((n=d.sent()).done)return[3,5];if(a=n.value,o)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{s=this.doDecodeSync(),o=!0}catch(t){if(!(t instanceof Ln))throw t}this.totalPos+=this.pos,d.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return c=d.sent(),r={error:c},[3,12];case 7:return d.trys.push([7,,10,11]),n&&!n.done&&(i=e.return)?[4,i.call(e)]:[3,9];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(o){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,s]}throw l=(u=this).headByte,h=u.pos,f=u.totalPos,new RangeError("Insufficient data in parsing "+kn(l)+" at "+f+" ("+h+" in the current buffer)")}}))}))},t.prototype.decodeArrayStream=function(t){return this.decodeMultiAsync(t,!0)},t.prototype.decodeStream=function(t){return this.decodeMultiAsync(t,!1)},t.prototype.decodeMultiAsync=function(t,e){return In(this,arguments,(function(){var n,r,i,o,s,a,c,u,l;return An(this,(function(h){switch(h.label){case 0:n=e,r=-1,h.label=1;case 1:h.trys.push([1,13,14,19]),i=jn(t),h.label=2;case 2:return[4,On(i.next())];case 3:if((o=h.sent()).done)return[3,12];if(s=o.value,e&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(r=this.readArraySize(),n=!1,this.complete()),h.label=4;case 4:h.trys.push([4,9,,10]),h.label=5;case 5:return[4,On(this.doDecodeSync())];case 6:return[4,h.sent()];case 7:return h.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((a=h.sent())instanceof Ln))throw a;return[3,10];case 10:this.totalPos+=this.pos,h.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c=h.sent(),u={error:c},[3,19];case 14:return h.trys.push([14,,17,18]),o&&!o.done&&(l=i.return)?[4,On(l.call(i))]:[3,16];case 15:h.sent(),h.label=16;case 16:return[3,18];case 17:if(u)throw u.error;return[7];case 18:return[7];case 19:return[2]}}))}))},t.prototype.doDecodeSync=function(){t:for(;;){var t=this.readHeadByte(),e=void 0;if(t>=224)e=t-256;else if(t<192)if(t<128)e=t;else if(t<144){if(0!==(r=t-128)){this.pushMapState(r),this.complete();continue t}e={}}else if(t<160){if(0!==(r=t-144)){this.pushArrayState(r),this.complete();continue t}e=[]}else{var n=t-160;e=this.decodeUtf8String(n,0)}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.readI64();else if(217===t){n=this.lookU8();e=this.decodeUtf8String(n,1)}else if(218===t){n=this.lookU16();e=this.decodeUtf8String(n,2)}else if(219===t){n=this.lookU32();e=this.decodeUtf8String(n,4)}else if(220===t){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(221===t){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(222===t){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue t}e={}}else if(223===t){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue t}e={}}else if(196===t){var r=this.lookU8();e=this.decodeBinary(r,1)}else if(197===t){r=this.lookU16();e=this.decodeBinary(r,2)}else if(198===t){r=this.lookU32();e=this.decodeBinary(r,4)}else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t){r=this.lookU8();e=this.decodeExtension(r,1)}else if(200===t){r=this.lookU16();e=this.decodeExtension(r,2)}else{if(201!==t)throw new bn("Unrecognized type byte: "+kn(t));r=this.lookU32();e=this.decodeExtension(r,4)}this.complete();for(var i=this.stack;i.length>0;){var o=i[i.length-1];if(0===o.type){if(o.array[o.position]=e,o.position++,o.position!==o.size)continue t;i.pop(),e=o.array}else{if(1===o.type){if(s=void 0,"string"!==(s=typeof e)&&"number"!==s)throw new bn("The type of key must be string or number but "+typeof e);if("__proto__"===e)throw new bn("The key __proto__ is not allowed");o.key=e,o.type=2;continue t}if(o.map[o.key]=e,o.readCount++,o.readCount!==o.size){o.key=null,o.type=1;continue t}i.pop(),e=o.map}}return e}var s},t.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=-1},t.prototype.readArraySize=function(){var t=this.readHeadByte();switch(t){case 220:return this.readU16();case 221:return this.readU32();default:if(t<160)return t-144;throw new bn("Unrecognized array type byte: "+kn(t))}},t.prototype.pushMapState=function(t){if(t>this.maxMapLength)throw new bn("Max length exceeded: map length ("+t+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:t,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(t){if(t>this.maxArrayLength)throw new bn("Max length exceeded: array length ("+t+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:t,array:new Array(t),position:0})},t.prototype.decodeUtf8String=function(t,e){var n;if(t>this.maxStrLength)throw new bn("Max length exceeded: UTF-8 byte length ("+t+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+e+t)throw Bn;var r,i=this.pos+e;return r=this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(t))?this.keyDecoder.decode(this.bytes,i,t):t>yn?function(t,e,n){var r=t.subarray(e,e+n);return pn.decode(r)}(this.bytes,i,t):dn(this.bytes,i,t),this.pos+=e+t,r},t.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},t.prototype.decodeBinary=function(t,e){if(t>this.maxBinLength)throw new bn("Max length exceeded: bin length ("+t+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(t+e))throw Bn;var n=this.pos+e,r=this.bytes.subarray(n,n+t);return this.pos+=e+t,r},t.prototype.decodeExtension=function(t,e){if(t>this.maxExtLength)throw new bn("Max length exceeded: ext length ("+t+") > maxExtLength ("+this.maxExtLength+")");var n=this.view.getInt8(this.pos+e),r=this.decodeBinary(t,e+1);return this.extensionCodec.decode(r,n,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var t=this.view.getUint8(this.pos);return this.pos++,t},t.prototype.readI8=function(){var t=this.view.getInt8(this.pos);return this.pos++,t},t.prototype.readU16=function(){var t=this.view.getUint16(this.pos);return this.pos+=2,t},t.prototype.readI16=function(){var t=this.view.getInt16(this.pos);return this.pos+=2,t},t.prototype.readU32=function(){var t=this.view.getUint32(this.pos);return this.pos+=4,t},t.prototype.readI32=function(){var t=this.view.getInt32(this.pos);return this.pos+=4,t},t.prototype.readU64=function(){var t,e,n=(t=this.view,e=this.pos,4294967296*t.getUint32(e)+t.getUint32(e+4));return this.pos+=8,n},t.prototype.readI64=function(){var t=an(this.view,this.pos);return this.pos+=8,t},t.prototype.readF32=function(){var t=this.view.getFloat32(this.pos);return this.pos+=4,t},t.prototype.readF64=function(){var t=this.view.getFloat64(this.pos);return this.pos+=8,t},t}(),Dn={};function zn(t,e){return void 0===e&&(e=Dn),new Mn(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decode(t)}var Hn="object"==typeof global&&global&&global.Object===Object&&global,Fn="object"==typeof self&&self&&self.Object===Object&&self,qn=Hn||Fn||Function("return this")(),Nn=qn.Symbol,Wn=Object.prototype,Vn=Wn.hasOwnProperty,Kn=Wn.toString,Zn=Nn?Nn.toStringTag:void 0;var Gn=Object.prototype.toString;var Xn=Nn?Nn.toStringTag:void 0;function Jn(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Xn&&Xn in Object(t)?function(t){var e=Vn.call(t,Zn),n=t[Zn];try{t[Zn]=void 0;var r=!0}catch(t){}var i=Kn.call(t);return r&&(e?t[Zn]=n:delete t[Zn]),i}(t):function(t){return Gn.call(t)}(t)}function Yn(t){return null!=t&&"object"==typeof t}var Qn=Array.isArray;function tr(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function er(t){return t}function nr(t){if(!tr(t))return!1;var e=Jn(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var rr,ir=qn["__core-js_shared__"],or=(rr=/[^.]+$/.exec(ir&&ir.keys&&ir.keys.IE_PROTO||""))?"Symbol(src)_1."+rr:"";var sr=Function.prototype.toString;function ar(t){if(null!=t){try{return sr.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var cr=/^\[object .+?Constructor\]$/,ur=Function.prototype,lr=Object.prototype,hr=ur.toString,fr=lr.hasOwnProperty,dr=RegExp("^"+hr.call(fr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function pr(t){return!(!tr(t)||(e=t,or&&or in e))&&(nr(t)?dr:cr).test(ar(t));var e}function yr(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return pr(n)?n:void 0}var vr=yr(qn,"WeakMap"),gr=Object.create,mr=function(){function t(){}return function(e){if(!tr(e))return{};if(gr)return gr(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function br(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function wr(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var _r=Date.now;var xr,Sr,Er,Cr=function(){try{var t=yr(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),kr=(xr=Cr?function(t,e){return Cr(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:er,Sr=0,Er=0,function(){var t=_r(),e=16-(t-Er);if(Er=t,e>0){if(++Sr>=800)return arguments[0]}else Sr=0;return xr.apply(void 0,arguments)});var $r=/^(?:0|[1-9]\d*)$/;function Ur(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&$r.test(t))&&t>-1&&t%1==0&&t<e}function Ar(t,e,n){"__proto__"==e&&Cr?Cr(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function jr(t,e){return t===e||t!=t&&e!=e}var Or=Object.prototype.hasOwnProperty;function Ir(t,e,n){var r=t[e];Or.call(t,e)&&jr(r,n)&&(void 0!==n||e in t)||Ar(t,e,n)}function Tr(t,e,n,r){var i=!n;n||(n={});for(var o=-1,s=e.length;++o<s;){var a=e[o],c=r?r(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),i?Ar(n,a,c):Ir(n,a,c)}return n}var Pr=Math.max;function Lr(t,e){return kr(function(t,e,n){return e=Pr(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=Pr(r.length-e,0),s=Array(o);++i<o;)s[i]=r[e+i];i=-1;for(var a=Array(e+1);++i<e;)a[i]=r[i];return a[e]=n(s),br(t,this,a)}}(t,e,er),t+"")}function Br(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function Rr(t){return null!=t&&Br(t.length)&&!nr(t)}var Mr=Object.prototype;function Dr(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Mr)}function zr(t){return Yn(t)&&"[object Arguments]"==Jn(t)}var Hr=Object.prototype,Fr=Hr.hasOwnProperty,qr=Hr.propertyIsEnumerable,Nr=zr(function(){return arguments}())?zr:function(t){return Yn(t)&&Fr.call(t,"callee")&&!qr.call(t,"callee")};var Wr="object"==typeof exports&&exports&&!exports.nodeType&&exports,Vr=Wr&&"object"==typeof module&&module&&!module.nodeType&&module,Kr=Vr&&Vr.exports===Wr?qn.Buffer:void 0,Zr=(Kr?Kr.isBuffer:void 0)||function(){return!1},Gr={};function Xr(t){return function(e){return t(e)}}Gr["[object Float32Array]"]=Gr["[object Float64Array]"]=Gr["[object Int8Array]"]=Gr["[object Int16Array]"]=Gr["[object Int32Array]"]=Gr["[object Uint8Array]"]=Gr["[object Uint8ClampedArray]"]=Gr["[object Uint16Array]"]=Gr["[object Uint32Array]"]=!0,Gr["[object Arguments]"]=Gr["[object Array]"]=Gr["[object ArrayBuffer]"]=Gr["[object Boolean]"]=Gr["[object DataView]"]=Gr["[object Date]"]=Gr["[object Error]"]=Gr["[object Function]"]=Gr["[object Map]"]=Gr["[object Number]"]=Gr["[object Object]"]=Gr["[object RegExp]"]=Gr["[object Set]"]=Gr["[object String]"]=Gr["[object WeakMap]"]=!1;var Jr="object"==typeof exports&&exports&&!exports.nodeType&&exports,Yr=Jr&&"object"==typeof module&&module&&!module.nodeType&&module,Qr=Yr&&Yr.exports===Jr&&Hn.process,ti=function(){try{var t=Yr&&Yr.require&&Yr.require("util").types;return t||Qr&&Qr.binding&&Qr.binding("util")}catch(t){}}(),ei=ti&&ti.isTypedArray,ni=ei?Xr(ei):function(t){return Yn(t)&&Br(t.length)&&!!Gr[Jn(t)]},ri=Object.prototype.hasOwnProperty;function ii(t,e){var n=Qn(t),r=!n&&Nr(t),i=!n&&!r&&Zr(t),o=!n&&!r&&!i&&ni(t),s=n||r||i||o,a=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],c=a.length;for(var u in t)!e&&!ri.call(t,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ur(u,c))||a.push(u);return a}function oi(t,e){return function(n){return t(e(n))}}var si=oi(Object.keys,Object),ai=Object.prototype.hasOwnProperty;function ci(t){return Rr(t)?ii(t):function(t){if(!Dr(t))return si(t);var e=[];for(var n in Object(t))ai.call(t,n)&&"constructor"!=n&&e.push(n);return e}(t)}var ui=Object.prototype.hasOwnProperty;function li(t){if(!tr(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Dr(t),n=[];for(var r in t)("constructor"!=r||!e&&ui.call(t,r))&&n.push(r);return n}function hi(t){return Rr(t)?ii(t,!0):li(t)}var fi=yr(Object,"create");var di=Object.prototype.hasOwnProperty;var pi=Object.prototype.hasOwnProperty;function yi(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function vi(t,e){for(var n=t.length;n--;)if(jr(t[n][0],e))return n;return-1}yi.prototype.clear=function(){this.__data__=fi?fi(null):{},this.size=0},yi.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yi.prototype.get=function(t){var e=this.__data__;if(fi){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return di.call(e,t)?e[t]:void 0},yi.prototype.has=function(t){var e=this.__data__;return fi?void 0!==e[t]:pi.call(e,t)},yi.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=fi&&void 0===e?"__lodash_hash_undefined__":e,this};var gi=Array.prototype.splice;function mi(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}mi.prototype.clear=function(){this.__data__=[],this.size=0},mi.prototype.delete=function(t){var e=this.__data__,n=vi(e,t);return!(n<0)&&(n==e.length-1?e.pop():gi.call(e,n,1),--this.size,!0)},mi.prototype.get=function(t){var e=this.__data__,n=vi(e,t);return n<0?void 0:e[n][1]},mi.prototype.has=function(t){return vi(this.__data__,t)>-1},mi.prototype.set=function(t,e){var n=this.__data__,r=vi(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};var bi=yr(qn,"Map");function wi(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function _i(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function xi(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}_i.prototype.clear=function(){this.size=0,this.__data__={hash:new yi,map:new(bi||mi),string:new yi}},_i.prototype.delete=function(t){var e=wi(this,t).delete(t);return this.size-=e?1:0,e},_i.prototype.get=function(t){return wi(this,t).get(t)},_i.prototype.has=function(t){return wi(this,t).has(t)},_i.prototype.set=function(t,e){var n=wi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var Si=oi(Object.getPrototypeOf,Object),Ei=Function.prototype,Ci=Object.prototype,ki=Ei.toString,$i=Ci.hasOwnProperty,Ui=ki.call(Object);function Ai(t){var e=this.__data__=new mi(t);this.size=e.size}Ai.prototype.clear=function(){this.__data__=new mi,this.size=0},Ai.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},Ai.prototype.get=function(t){return this.__data__.get(t)},Ai.prototype.has=function(t){return this.__data__.has(t)},Ai.prototype.set=function(t,e){var n=this.__data__;if(n instanceof mi){var r=n.__data__;if(!bi||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new _i(r)}return n.set(t,e),this.size=n.size,this};var ji="object"==typeof exports&&exports&&!exports.nodeType&&exports,Oi=ji&&"object"==typeof module&&module&&!module.nodeType&&module,Ii=Oi&&Oi.exports===ji?qn.Buffer:void 0,Ti=Ii?Ii.allocUnsafe:void 0;function Pi(t,e){if(e)return t.slice();var n=t.length,r=Ti?Ti(n):new t.constructor(n);return t.copy(r),r}function Li(){return[]}var Bi=Object.prototype.propertyIsEnumerable,Ri=Object.getOwnPropertySymbols,Mi=Ri?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}(Ri(t),(function(e){return Bi.call(t,e)})))}:Li;var Di=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)xi(e,Mi(t)),t=Si(t);return e}:Li;function zi(t,e,n){var r=e(t);return Qn(t)?r:xi(r,n(t))}function Hi(t){return zi(t,ci,Mi)}function Fi(t){return zi(t,hi,Di)}var qi=yr(qn,"DataView"),Ni=yr(qn,"Promise"),Wi=yr(qn,"Set"),Vi="[object Map]",Ki="[object Promise]",Zi="[object Set]",Gi="[object WeakMap]",Xi="[object DataView]",Ji=ar(qi),Yi=ar(bi),Qi=ar(Ni),to=ar(Wi),eo=ar(vr),no=Jn;(qi&&no(new qi(new ArrayBuffer(1)))!=Xi||bi&&no(new bi)!=Vi||Ni&&no(Ni.resolve())!=Ki||Wi&&no(new Wi)!=Zi||vr&&no(new vr)!=Gi)&&(no=function(t){var e=Jn(t),n="[object Object]"==e?t.constructor:void 0,r=n?ar(n):"";if(r)switch(r){case Ji:return Xi;case Yi:return Vi;case Qi:return Ki;case to:return Zi;case eo:return Gi}return e});var ro=no,io=Object.prototype.hasOwnProperty;var oo=qn.Uint8Array;function so(t){var e=new t.constructor(t.byteLength);return new oo(e).set(new oo(t)),e}var ao=/\w*$/;var co=Nn?Nn.prototype:void 0,uo=co?co.valueOf:void 0;function lo(t,e){var n=e?so(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function ho(t,e,n){var r,i,o,s=t.constructor;switch(e){case"[object ArrayBuffer]":return so(t);case"[object Boolean]":case"[object Date]":return new s(+t);case"[object DataView]":return function(t,e){var n=e?so(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return lo(t,n);case"[object Map]":return new s;case"[object Number]":case"[object String]":return new s(t);case"[object RegExp]":return(o=new(i=t).constructor(i.source,ao.exec(i))).lastIndex=i.lastIndex,o;case"[object Set]":return new s;case"[object Symbol]":return r=t,uo?Object(uo.call(r)):{}}}function fo(t){return"function"!=typeof t.constructor||Dr(t)?{}:mr(Si(t))}var po=ti&&ti.isMap,yo=po?Xr(po):function(t){return Yn(t)&&"[object Map]"==ro(t)};var vo=ti&&ti.isSet,go=vo?Xr(vo):function(t){return Yn(t)&&"[object Set]"==ro(t)},mo="[object Arguments]",bo="[object Function]",wo="[object Object]",_o={};function xo(t,e,n,r,i,o){var s,a=1&e,c=2&e,u=4&e;if(n&&(s=i?n(t,r,i,o):n(t)),void 0!==s)return s;if(!tr(t))return t;var l=Qn(t);if(l){if(s=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&io.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!a)return wr(t,s)}else{var h=ro(t),f=h==bo||"[object GeneratorFunction]"==h;if(Zr(t))return Pi(t,a);if(h==wo||h==mo||f&&!i){if(s=c||f?{}:fo(t),!a)return c?function(t,e){return Tr(t,Di(t),e)}(t,function(t,e){return t&&Tr(e,hi(e),t)}(s,t)):function(t,e){return Tr(t,Mi(t),e)}(t,function(t,e){return t&&Tr(e,ci(e),t)}(s,t))}else{if(!_o[h])return i?t:{};s=ho(t,h,a)}}o||(o=new Ai);var d=o.get(t);if(d)return d;o.set(t,s),go(t)?t.forEach((function(r){s.add(xo(r,e,n,r,t,o))})):yo(t)&&t.forEach((function(r,i){s.set(i,xo(r,e,n,i,t,o))}));var p=l?void 0:(u?c?Fi:Hi:c?hi:ci)(t);return function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););}(p||t,(function(r,i){p&&(r=t[i=r]),Ir(s,i,xo(r,e,n,i,t,o))})),s}_o[mo]=_o["[object Array]"]=_o["[object ArrayBuffer]"]=_o["[object DataView]"]=_o["[object Boolean]"]=_o["[object Date]"]=_o["[object Float32Array]"]=_o["[object Float64Array]"]=_o["[object Int8Array]"]=_o["[object Int16Array]"]=_o["[object Int32Array]"]=_o["[object Map]"]=_o["[object Number]"]=_o[wo]=_o["[object RegExp]"]=_o["[object Set]"]=_o["[object String]"]=_o["[object Symbol]"]=_o["[object Uint8Array]"]=_o["[object Uint8ClampedArray]"]=_o["[object Uint16Array]"]=_o["[object Uint32Array]"]=!0,_o["[object Error]"]=_o[bo]=_o["[object WeakMap]"]=!1;function So(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new _i;++e<n;)this.add(t[e])}function Eo(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}So.prototype.add=So.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},So.prototype.has=function(t){return this.__data__.has(t)};function Co(t,e,n,r,i,o){var s=1&n,a=t.length,c=e.length;if(a!=c&&!(s&&c>a))return!1;var u=o.get(t),l=o.get(e);if(u&&l)return u==e&&l==t;var h=-1,f=!0,d=2&n?new So:void 0;for(o.set(t,e),o.set(e,t);++h<a;){var p=t[h],y=e[h];if(r)var v=s?r(y,p,h,e,t,o):r(p,y,h,t,e,o);if(void 0!==v){if(v)continue;f=!1;break}if(d){if(!Eo(e,(function(t,e){if(s=e,!d.has(s)&&(p===t||i(p,t,n,r,o)))return d.push(e);var s}))){f=!1;break}}else if(p!==y&&!i(p,y,n,r,o)){f=!1;break}}return o.delete(t),o.delete(e),f}function ko(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function $o(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var Uo=Nn?Nn.prototype:void 0,Ao=Uo?Uo.valueOf:void 0;var jo=Object.prototype.hasOwnProperty;var Oo="[object Arguments]",Io="[object Array]",To="[object Object]",Po=Object.prototype.hasOwnProperty;function Lo(t,e,n,r,i,o){var s=Qn(t),a=Qn(e),c=s?Io:ro(t),u=a?Io:ro(e),l=(c=c==Oo?To:c)==To,h=(u=u==Oo?To:u)==To,f=c==u;if(f&&Zr(t)){if(!Zr(e))return!1;s=!0,l=!1}if(f&&!l)return o||(o=new Ai),s||ni(t)?Co(t,e,n,r,i,o):function(t,e,n,r,i,o,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new oo(t),new oo(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return jr(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=ko;case"[object Set]":var c=1&r;if(a||(a=$o),t.size!=e.size&&!c)return!1;var u=s.get(t);if(u)return u==e;r|=2,s.set(t,e);var l=Co(a(t),a(e),r,i,o,s);return s.delete(t),l;case"[object Symbol]":if(Ao)return Ao.call(t)==Ao.call(e)}return!1}(t,e,c,n,r,i,o);if(!(1&n)){var d=l&&Po.call(t,"__wrapped__"),p=h&&Po.call(e,"__wrapped__");if(d||p){var y=d?t.value():t,v=p?e.value():e;return o||(o=new Ai),i(y,v,n,r,o)}}return!!f&&(o||(o=new Ai),function(t,e,n,r,i,o){var s=1&n,a=Hi(t),c=a.length;if(c!=Hi(e).length&&!s)return!1;for(var u=c;u--;){var l=a[u];if(!(s?l in e:jo.call(e,l)))return!1}var h=o.get(t),f=o.get(e);if(h&&f)return h==e&&f==t;var d=!0;o.set(t,e),o.set(e,t);for(var p=s;++u<c;){var y=t[l=a[u]],v=e[l];if(r)var g=s?r(v,y,l,e,t,o):r(y,v,l,t,e,o);if(!(void 0===g?y===v||i(y,v,n,r,o):g)){d=!1;break}p||(p="constructor"==l)}if(d&&!p){var m=t.constructor,b=e.constructor;m==b||!("constructor"in t)||!("constructor"in e)||"function"==typeof m&&m instanceof m&&"function"==typeof b&&b instanceof b||(d=!1)}return o.delete(t),o.delete(e),d}(t,e,n,r,i,o))}function Bo(t,e,n,r,i){return t===e||(null==t||null==e||!Yn(t)&&!Yn(e)?t!=t&&e!=e:Lo(t,e,n,r,Bo,i))}var Ro,Mo=function(t,e,n){for(var r=-1,i=Object(t),o=n(t),s=o.length;s--;){var a=o[Ro?s:++r];if(!1===e(i[a],a,i))break}return t};function Do(t,e,n){(void 0!==n&&!jr(t[e],n)||void 0===n&&!(e in t))&&Ar(t,e,n)}function zo(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function Ho(t,e,n,r,i,o,s){var a=zo(t,n),c=zo(e,n),u=s.get(c);if(u)Do(t,n,u);else{var l,h=o?o(a,c,n+"",t,e,s):void 0,f=void 0===h;if(f){var d=Qn(c),p=!d&&Zr(c),y=!d&&!p&&ni(c);h=c,d||p||y?Qn(a)?h=a:Yn(l=a)&&Rr(l)?h=wr(a):p?(f=!1,h=Pi(c,!0)):y?(f=!1,h=lo(c,!0)):h=[]:function(t){if(!Yn(t)||"[object Object]"!=Jn(t))return!1;var e=Si(t);if(null===e)return!0;var n=$i.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&ki.call(n)==Ui}(c)||Nr(c)?(h=a,Nr(a)?h=function(t){return Tr(t,hi(t))}(a):tr(a)&&!nr(a)||(h=fo(c))):f=!1}f&&(s.set(c,h),i(h,c,r,o,s),s.delete(c)),Do(t,n,h)}}function Fo(t,e,n,r,i){t!==e&&Mo(e,(function(o,s){if(i||(i=new Ai),tr(o))Ho(t,e,s,n,Fo,r,i);else{var a=r?r(zo(t,s),o,s+"",t,e,i):void 0;void 0===a&&(a=o),Do(t,s,a)}}),hi)}var qo,No,Wo=(qo=function(t,e,n){Fo(t,e,n)},Lr((function(t,e){var n=-1,r=e.length,i=r>1?e[r-1]:void 0,o=r>2?e[2]:void 0;for(i=qo.length>3&&"function"==typeof i?(r--,i):void 0,o&&function(t,e,n){if(!tr(n))return!1;var r=typeof e;return!!("number"==r?Rr(n)&&Ur(e,n.length):"string"==r&&e in n)&&jr(n[e],t)}(e[0],e[1],o)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var s=e[n];s&&qo(t,s,n,i)}return t})));!function(t){t.SyncReq="SyncReq",t.SyncResp="SyncResp",t.ChangeReq="ChangeReq",t.ChangeNotice="ChangeNotice",t.CommitNotice="CommitNotice",t.Heartbeat="Heartbeat",t.FolkLore="FolkLore"}(No||(No={}));const Vo=[No.SyncReq,No.SyncResp,No.ChangeReq,No.ChangeNotice,No.CommitNotice,No.Heartbeat,No.FolkLore];function Ko(t){if(null==t)return t;if(t instanceof Uint8Array)return zn(t);if("object"!=typeof t)return t;if(Array.isArray(t))return t.map(Ko);const e={};for(const n of Object.keys(t))e[n]=Ko(t[n]);return e}class Zo{constructor(t,e,n="syn"){this.cellClient=t,this.handleSignal=e,this.zomeName=n,this.unsubscribe=()=>{},t.addSignalHandler((n=>{var r,i;console.log(n),r=t.cellId,i=n.data.cellId,Bo(r,i)&&n.data.payload.message&&Vo.includes(n.data.payload.message.type)&&e(Ko(n.data.payload))})).then((({unsubscribe:t})=>this.unsubscribe=t))}close(){return this.unsubscribe()}putSnapshot(t){return this.callZome("put_snapshot",Cn(t))}async getSnapshot(t){return zn(await this.callZome("get_snapshot",t))}commit(t){const e=Object.assign(Object.assign({},t),{commit:Object.assign(Object.assign({},t.commit),{changes:this.encodeChangeBundle(t.commit.changes)})});return this.callZome("commit",e)}hashContent(t){return this.callZome("hash_content",Cn(t))}async getSession(t){const e=await this.callZome("get_session",t);return this.decodeSessionInfo(e)}async newSession(t){const e=await this.callZome("new_session",t);return this.decodeSessionInfo(e)}getSessions(){return this.callZome("get_sessions",null)}getFolks(){return this.callZome("get_folks",null)}sendFolkLore(t){return this.callZome("send_folk_lore",t)}sendSyncRequest(t){return this.callZome("send_sync_request",t)}sendSyncResponse(t){const e={};for(const n of Object.keys(t.state.missedCommits))e[n]=this.encodeCommit(t.state.missedCommits[n]);const n=Object.assign(Object.assign({},t),{state:Object.assign(Object.assign({},t.state),{missedCommits:e,uncommittedChanges:this.encodeChangeBundle(t.state.uncommittedChanges)})});return this.callZome("send_sync_response",n)}sendChangeRequest(t){const e=Object.assign(Object.assign({},t),{deltas:t.deltas.map((t=>Cn(t)))});return this.callZome("send_change_request",e)}sendChange(t){const e=Object.assign(Object.assign({},t),{changes:this.encodeChangeBundle(t.changes)});return this.callZome("send_change",e)}sendHeartbeat(t){return this.callZome("send_heartbeat",t)}async callZome(t,e){return this.cellClient.callZome(this.zomeName,t,e)}decodeSessionInfo(t){const e={};for(const[n,r]of Object.entries(t.commits))e[n]=this.decodeCommit(r);return Object.assign(Object.assign({},t),{commits:e,snapshot:zn(t.snapshot)})}encodeCommit(t){return Object.assign(Object.assign({},t),{changes:this.encodeChangeBundle(t.changes)})}encodeChangeBundle(t){return Object.assign(Object.assign({},t),{deltas:t.deltas.map((t=>Cn(t)))})}decodeCommit(t){return Object.assign(Object.assign({},t),{changes:{deltas:t.changes.deltas.map((t=>zn(t)))}})}}function Go(t,e){return Xo(t,e)===t.myPubKey}function Xo(t,e){return t.joinedSessions[e].session.scribe}function Jo(t,e){return t.joinedSessions[e]}function Yo(t,e){const n=Qo(t,e);return n?n.createdAt:Jo(t,e).session.createdAt}function Qo(t,e){const n=ts(Jo(t,e));return n?t.commits[n]:void 0}function ts(t){if(0!==t.commitHashes.length)return t.commitHashes[t.commitHashes.length-1]}function es(t,e){const n=Qo(t,e);return n?n.newContentHash:t.joinedSessions[e].session.snapshotHash}function ns(t){return t.uncommittedChanges.atSessionIndex+t.uncommittedChanges.deltas.length}function rs(t){return Object.entries(t.folks).filter((([t,e])=>e.inSession)).map((([t,e])=>t))}function is(t){const e="#"+function(t){let e="";for(const n of t)e+=n.toString(16);return e}(t).slice(-6);let n=function(t,e,n){t/=255,e/=255,n/=255;let r,i,o=Math.max(t,e,n),s=Math.min(t,e,n),a=(o+s)/2;if(o==s)r=i=0;else{let c=o-s;switch(i=a>.5?c/(2-o-s):c/(o+s),o){case t:r=(e-n)/c+(e<n?6:0);break;case e:r=(n-t)/c+2;break;case n:r=(t-e)/c+4}r/=6}return[360*r,100*i,100*a]}(parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16));var r,i,o;n[1]=(r=n[1],i=10,o=90,Math.min(Math.max(r,i),o));const[s,a,c]=n;return{primary:[s,a,50],hexagon:[s,a,25],selection:[s,a,90],lookingSelection:[s,a,80],lookingCursor:[s,a+10,40]}}function os(t,e,n){const r=Date.now();for(const i of n)if(i!==e)if(t.folks[i])t.folks[i].lastSeen=r,t.folks[i].inSession=!0;else{const e=is(i);t.folks[i]={lastSeen:r,inSession:!0,colors:e}}}function ss(t,e){let n={};for(const[t,r]of Object.entries(e))n[r.previousContentHash]=t;let r=[],i=t;for(;Object.keys(n).length>0;){if(!n[i])throw new Error("We have a corrupted chain of commits");r.push(n[i]),n[i]=void 0,delete n[i]}return r}function as(t,e,n){let r=t;for(const t of n)r=cs(r,e,t.changes);return r}function cs(t,e,n){let r=t;for(const t of n.deltas)r=e(r,t);return r}function us(t,e,n){const r=Jo(t,e),i=ts(r);return{changes:r.uncommittedChanges,newContentHash:n,previousCommitHashes:i?[i]:[],previousContentHash:es(t,e),createdAt:Date.now(),meta:{appSpecific:null,witnesses:[]}}}function ls(t,e,n,r){t.commits[n]=r;const i=Jo(t,e);i.commitHashes.push(n);const o=r.changes.atSessionIndex+r.changes.deltas.length;i.uncommittedChanges={atSessionIndex:o,authors:{},deltas:[]}}async function hs(t,e){const n=u(t.store);if(!Go(n,e))return console.log("Trying to commit the changes but I'm not the scribe!"),n;let r=Jo(n,e);const i=await t.client.hashContent(r.currentContent),o=us(n,e,i),s={commit:o,participants:rs(r),sessionHash:e,sessionSnapshot:r.session.snapshotHash},a=await t.client.commit(s);t.store.update((t=>(ls(t,e,a,o),t)))}function fs(t,e,n){t.config.commitStrategy.CommitEveryNDeltas&&t.config.commitStrategy.CommitEveryNDeltas<=n&&hs(t,e)}function ds(t,e,n,r,i){const o=ns(e);e.uncommittedChanges.deltas=[...e.uncommittedChanges.deltas,...i];let s=e.currentContent;for(const e of i)s=t(s,e);e.currentContent=s;const a=[];for(let t=o;t<o+i.length;t++)a.push(t);return{atSessionIndex:o,deltas:i,authors:{[n]:{atFolkIndex:r,sessionChanges:a}}}}function ps(t,e,n){t.store.update((t=>{if(Go(t,e))return console.log("Received folklore but I'm the scribe, ignoring"),t;const r=Jo(t,e);return n.gone?function(t,e){for(const n of e)t.folks[n]?t.folks[n].inSession=!1:t.folks[n]={inSession:!1,lastSeen:0,colors:is(n)}}(r,n.gone):os(r,t.myPubKey,n.participants),t}))}function ys(t,e){t.store.update((n=>{const r=Jo(n,e),i=function(t,e){const n=[],r=Date.now();for(const i of Object.keys(t.folks))r-t.folks[i].lastSeen>e&&(t.folks[i].inSession=!1,n.push(i));return n}(r,t.config.outOfSessionTimeout);return i.length>0&&t.client.sendFolkLore({data:{gone:i},participants:rs(r),sessionHash:e}),n}))}async function vs(t,e){const n=await t.client.getSession(e),r=ss(n.session.snapshotHash,n.commits),i=r.map((t=>n.commits[t])),o=as(n.snapshot,t.applyDeltaFn,i);t.store.update((e=>(e.joinedSessions[n.sessionHash]={sessionHash:n.sessionHash,session:n.session,commitHashes:r,currentContent:o,myFolkIndex:0,prerequestContent:void 0,requestedChanges:[],uncommittedChanges:{atSessionIndex:0,authors:{},deltas:[]},folks:{}},n.session.scribe!==e.myPubKey&&t.client.sendSyncRequest({scribe:n.session.scribe,sessionHash:n.sessionHash,lastSessionIndexSeen:0}),e.activeSessionHash=n.sessionHash,e)))}function gs(t,e,n){t.store.update((r=>{const i=Jo(r,e);i.prerequestContent=xo(i.currentContent,5);for(const e of n)i.currentContent=t.applyDeltaFn(i.currentContent,e);const o=[],s=Date.now();console.log(i.uncommittedChanges);const a=ns(i);for(let t=0;t<n.length;t++)o.push({atDate:s,atFolkIndex:i.myFolkIndex+t,atSessionIndex:a+t,delta:n[t]});return i.requestedChanges=[...i.requestedChanges,...o],t.client.sendChangeRequest({atFolkIndex:i.myFolkIndex,atSessionIndex:a,deltas:n,scribe:i.session.scribe,sessionHash:e}),i.myFolkIndex+=n.length,r}))}async function ms(t,e){let n=u(t.store);if(Go(n,e))return;let r=Jo(n,e);console.log(r.requestedChanges),r.requestedChanges.length>0&&Date.now()-r.requestedChanges[0].atDate>t.config.requestTimeout&&(await vs(t,e),n=u(t.store),r=Jo(n,e),await t.client.sendSyncRequest({lastSessionIndexSeen:ns(r),scribe:r.session.scribe,sessionHash:e}))}function bs(t,e,n){t.store.update((r=>{if(Go(r,e))return console.warn("Received a change notice but I'm the scribe for this session, ignoring"),r;const i=Jo(r,e);i.currentContent=cs(i.currentContent,t.applyDeltaFn,n),i.uncommittedChanges.deltas=[...i.uncommittedChanges.deltas,n.deltas];for(const[t,e]of Object.entries(i.uncommittedChanges.authors))if(i.uncommittedChanges.authors[t]){const n=i.uncommittedChanges.authors[t];n.atFolkIndex,n.sessionChanges.length,e.atFolkIndex,n.sessionChanges=[...n.sessionChanges,...e.sessionChanges]}else i.uncommittedChanges.authors[t]=e;const o=n.authors[r.myPubKey];return o&&function(t,e){const n=[];for(const r of t.requestedChanges)r.atFolkIndex>=e.atFolkIndex&&r.atFolkIndex<e.atFolkIndex+e.sessionChanges.length||n.push(r);t.requestedChanges=n,0===t.requestedChanges.length&&(t.prerequestContent=void 0)}(i,o),r}))}function ws(t,e){if(Jo(u(t.store),e.sessionHash))switch(e.message.type){case No.SyncReq:return function(t,e,n){t.store.update((r=>{if(!Go(r,e))return console.log("syncReq received but I'm not the scribe!"),r;const i=Jo(r,e);os(i,r.myPubKey,[n.folk]);const o=function(t,e,n){const r=function(t,e){return t.joinedSessions[e].commitHashes.map((e=>[e,t.commits[e]]))}(t,e),i={};for(const t of r.reverse()){if(!(t[1].changes.atSessionIndex>n))return i;i[t[0]]=t[1]}return i}(r,e,n.lastSessionIndexSeen),s={uncommittedChanges:function(t,e,n){const r=t.joinedSessions[e];if(r.uncommittedChanges.atSessionIndex>=n)return r.uncommittedChanges;{const t=r.uncommittedChanges,e=n-t.atSessionIndex;return{atSessionIndex:n+1,deltas:t.deltas.slice(e),authors:t.authors}}}(r,e,n.lastSessionIndexSeen),missedCommits:o};t.client.sendSyncResponse({participant:n.folk,state:s,sessionHash:e});const a=rs(i);return t.client.sendFolkLore({participants:a,sessionHash:e,data:{participants:[...a,r.myPubKey]}}),r}))}(t,e.sessionHash,e.message.payload);case No.SyncResp:return function(t,e,n){t.store.update((r=>{const i=Jo(r,e),o=ss(es(r,e),n.missedCommits);for(const t of o)r.commits[t]=n.missedCommits[t];i.commitHashes=[...i.commitHashes,...o];const s=i.uncommittedChanges,a=s.atSessionIndex+s.deltas.length;if(a!==n.uncommittedChanges.atSessionIndex)throw new Error(`I requested changes from session index ${a} and received changes from ${n.uncommittedChanges.atSessionIndex}`);s.deltas=[...s.deltas,...n.uncommittedChanges.deltas],s.authors=Wo(s.authors,n.uncommittedChanges.authors);const c=o.map((t=>n.missedCommits[t]));let u=as(i.currentContent,t.applyDeltaFn,c);return i.currentContent=cs(u,t.applyDeltaFn,n.uncommittedChanges),r}))}(t,e.sessionHash,e.message.payload);case No.ChangeReq:return function(t,e,n){t.store.update((r=>{if(!Go(r,e))return console.warn("Received a change request but I'm not the scribe for this session"),r;const i=Jo(r,e);os(i,r.myPubKey,[n.folk]);const o=ns(i);if(o!==n.atSessionIndex)return console.warn("Scribe is receiving change out of order!"),console.warn(`nextIndex: ${o}, changeIndex:${n.atSessionIndex} for deltas:`,n.deltas),n.atSessionIndex,r;const s=ds(t.applyDeltaFn,i,n.folk,n.atFolkIndex,n.deltas);return t.client.sendChange({changes:s,participants:rs(i),sessionHash:e}),fs(t,e,i.uncommittedChanges.deltas.length),r}))}(t,e.sessionHash,e.message.payload);case No.ChangeNotice:return bs(t,e.sessionHash,e.message.payload);case No.CommitNotice:return function(t,e,n){t.store.update((t=>{if(Go(t,e))return console.log("Received a commit notice but I'm the scribe!"),t;const r=es(t,e),i=Jo(t,e);if(r===n.previousContentHash&&n.committedDeltasCount===i.uncommittedChanges.deltas.length){const r=us(t,e,n.newContentHash);ls(t,e,n.commitHash,r)}return t}))}(t,e.sessionHash,e.message.payload);case No.FolkLore:return ps(t,e.sessionHash,e.message.payload);case No.Heartbeat:return function(t,e,n){t.store.update((t=>Go(t,e)?(os(Jo(t,e),t.myPubKey,[n]),t):(console.log("Received a heartbeat from a folk but I'm not the scribe"),t)))}(t,e.sessionHash,e.message.payload.fromFolk)}else console.warn("We are getting a signal for a sesion we don't know about")}var _s,xs;function Ss(t,e){const n=u(t.store);return Go(n,e)?ys(t,e):t.client.sendHeartbeat({scribe:Xo(n,e),data:"hi",sessionHash:e})}function Es(t,e,n){return Go(u(t.store),e)?function(t,e,n){t.store.update((r=>{const i=Jo(r,e),o=ds(t.applyDeltaFn,i,r.myPubKey,i.myFolkIndex,n);return t.client.sendChange({participants:rs(i),sessionHash:e,changes:o}),fs(t,e,i.uncommittedChanges.deltas.length),i.myFolkIndex+=n.length,r}))}(t,e,n):gs(t,e,n)}function Cs(t,e){const n=tt(t.store,(t=>Jo(t,e).currentContent)),r=tt(t.store,(t=>Jo(t,e).folks));return{hash:e,info:Jo(u(t.store),e).session,content:n,folks:r,requestChange:n=>Es(t,e,n),leave:async()=>{}}}function ks(t,e,n,r){let i;const o=Wo(r,{hearbeatInterval:3e4,outOfSessionTimeout:8e3,requestTimeout:1e3,commitStrategy:{CommitEveryNDeltas:20,CommitEveryNMs:12e4},syncStrategy:_s.BlockOnConflict}),s=(a=t.cellId[1],`u${nn(a,!0)}`);var a;const c=Q(function(t){return{myPubKey:t,activeSessionHash:void 0,joinedSessions:{},commits:{},snapshots:{}}}(s)),l=new Zo(t,(t=>ws(i,t)));i={store:c,applyDeltaFn:n,client:l,initialContent:e,config:o};const{cancel:h}=function(t){const e=[],n=setInterval((()=>{const e=u(t.store);for(const n of Object.keys(e.joinedSessions))Ss(t,n)}),t.config.hearbeatInterval);e.push(n);const r=setInterval((()=>{const e=u(t.store);for(const n of Object.keys(e.joinedSessions))ms(t,n)}),t.config.requestTimeout/2);e.push(r);const i=t.config.commitStrategy.CommitEveryNMs;if(i){const n=setInterval((()=>{const e=u(t.store);for(const n of Object.keys(e.joinedSessions)){const r=Yo(e,n);Go(e,n)&&Date.now()-r>i&&hs(t,n)}}),i/10);e.push(n)}return{cancel:()=>e.forEach((t=>clearInterval(t)))}}(i),f=tt(c,(t=>{if(t.activeSessionHash)return Cs(i,t.activeSessionHash)}));return{myPubKey:s,myColors:is(s),getAllSessions:()=>l.getSessions(),joinSession:async t=>vs(i,t),activeSession:f,joinedSessions:tt(i.store,(t=>Object.keys(t.joinedSessions))),sessionStore:t=>Cs(i,t),newSession:async t=>async function(t,e){let n=t.initialContent;e?n=await t.client.getSnapshot(e):e=await t.client.putSnapshot(t.initialContent);const r=await t.client.newSession({snapshotHash:e});return t.store.update((t=>(t.joinedSessions[r.sessionHash]={sessionHash:r.sessionHash,session:r.session,commitHashes:[],currentContent:n,myFolkIndex:0,prerequestContent:void 0,requestedChanges:[],uncommittedChanges:{atSessionIndex:0,authors:{},deltas:[]},folks:{}},t.activeSessionHash=r.sessionHash,t))),r.sessionHash}(i,t),close:async()=>{l.close(),h()}}}function $s(){}function Us(t,...e){const n=e.length-1;return Y(null,(r=>{const i=t=>o=>{const s=e[t](o);if(s)return t===n?s.subscribe(r):As(s,i(t+1));r(null)};return As(t,i(0))}))}function As(t,e){let n=$s;const r=t.subscribe((t=>{n(),n=e(t)||$s}));return()=>{n(),r()}}function js(e){let n,i,o,s,a,c,u,l;return{c(){n=p("editor"),i=p("span"),o=y(e[2]),s=p("span"),a=p("span"),c=y(e[3]),m(s,"class","cursor svelte-nmti7n"),m(n,"tabindex","0"),m(n,"start","0"),m(n,"class","svelte-nmti7n")},m(t,r){f(t,n,r),h(n,i),h(i,o),h(n,s),e[12](s),h(n,a),h(a,c),e[13](n),u||(l=[g(n,"click",e[7]),g(n,"keydown",e[6])],u=!0)},p(t,[e]){4&e&&w(o,t[2]),8&e&&w(c,t[3])},i:t,o:t,d(t){t&&d(n),e[12](null),e[13](null),u=!1,r(l)}}}function Os(e,n,r){let i,o,s,a,u,h,f,d,p=t,y=t;l(e,nt,(t=>r(9,h=t))),e.$$.on_destroy.push((()=>p())),e.$$.on_destroy.push((()=>y())),C();const{getStore:v}=k("store"),g=v();function m(t){return d.meta&&d.meta[t]?d.meta[t]:0}let b,w;function _(t){console.log(f,d.body);const e=m(s),n=[{type:"Add",value:[e,t]}];for(const[r,i]of Object.entries(d.meta))i>=e&&n.push({type:"Meta",value:{setLoc:[r,i+t.length]}});f.requestChange(n)}return console.log(i),e.$$.update=()=>{1024&e.$$.dirty&&r(8,s=f?f.myTag:""),2304&e.$$.dirty&&r(2,a=d.body.slice(0,m(s))),2304&e.$$.dirty&&r(3,u=d.body.slice(m(s))),513&e.$$.dirty&&w&&h&&h.syn&&h.syn.myColors&&r(0,w.style["border-color"]=Be(h.syn.myColors.primary),w)},r(4,i=g.activeSession),p(),p=c(i,(t=>r(10,f=t))),r(5,o=Us(g.activeSession,(t=>t.content))),y(),y=c(o,(t=>r(11,d=t))),[w,b,a,u,i,o,function(t){const e=m(s),n=t.key;if(1==n.length)_(n);else switch(n){case"ArrowRight":e<d.body.length&&f.requestChange([{type:"Meta",value:{setLoc:[s,e+1]}}]);break;case"ArrowLeft":e>0&&f.requestChange([{type:"Meta",value:{setLoc:[s,e-1]}}]);break;case"Enter":_("\n");break;case"Backspace":if(e>0){const t=[{type:"Delete",value:[e-1,e]}];for(const[n,r]of Object.entries(d.meta))r>=e&&t.push({type:"Meta",value:{setLoc:[n,r-1]}});f.requestChange(t)}}console.log("input",t.key)},function(t){const e=window.getSelection().focusOffset;let n=e>0?e:0;window.getSelection().focusNode.parentElement==b.lastChild&&(n+=a.length),n!=m(s)&&f.requestChange([{type:"Meta",value:{setLoc:[s,n]}}])},s,h,f,d,function(t){U[t?"unshift":"push"]((()=>{w=t,r(0,w),r(9,h)}))},function(t){U[t?"unshift":"push"]((()=>{b=t,r(1,b)}))}]}!function(t){t[t.CRDT=0]="CRDT",t[t.BlockOnConflict=1]="BlockOnConflict",t[t.DropOnConflict=2]="DropOnConflict"}(_s||(_s={}));class Is extends X{constructor(t){super(),G(this,t,Os,js,o,{})}}function Ts(t){let e,n,i,o;function s(t,e){return t[4]?Bs:Ls}let a=s(t),c=a(t);return{c(){e=p("div"),n=p("span"),c.c(),m(n,"class","svelte-1turqhe"),x(n,"untitled",t[4]),m(e,"class","title svelte-1turqhe"),x(e,"title-hover",t[5])},m(r,s){f(r,e,s),h(e,n),c.m(n,null),i||(o=[g(e,"mouseenter",t[13]),g(e,"mouseleave",t[14]),g(e,"click",t[9])],i=!0)},p(t,r){a===(a=s(t))&&c?c.p(t,r):(c.d(1),c=a(t),c&&(c.c(),c.m(n,null))),16&r&&x(n,"untitled",t[4]),32&r&&x(e,"title-hover",t[5])},d(t){t&&d(e),c.d(),i=!1,r(o)}}}function Ps(t){let e,n,i;return{c(){e=p("input"),m(e,"class","title-input svelte-1turqhe")},m(r,o){f(r,e,o),_(e,t[1]),t[12](e),n||(i=[g(e,"input",t[11]),g(e,"keydown",t[10]),g(e,"blur",t[8])],n=!0)},p(t,n){2&n&&e.value!==t[1]&&_(e,t[1])},d(o){o&&d(e),t[12](null),n=!1,r(i)}}}function Ls(t){let e,n=t[0].title+"";return{c(){e=y(n)},m(t,n){f(t,e,n)},p(t,r){1&r&&n!==(n=t[0].title+"")&&w(e,n)},d(t){t&&d(e)}}}function Bs(e){let n;return{c(){n=y("Untitled Document")},m(t,e){f(t,n,e)},p:t,d(t){t&&d(n)}}}function Rs(e){let n,r;function i(t,e){return t[2]?Ps:Ts}let o=i(e),s=o(e);return{c(){n=p("div"),r=y("Title:\n  "),s.c(),m(n,"class","title-wrapper svelte-1turqhe")},m(t,e){f(t,n,e),h(n,r),s.m(n,null)},p(t,[e]){o===(o=i(t))&&s?s.p(t,e):(s.d(1),s=o(t),s&&(s.c(),s.m(n,null)))},i:t,o:t,d(t){t&&d(n),s.d()}}}function Ms(e,n,r){let i,o,s,a,u=t,l=t;e.$$.on_destroy.push((()=>u())),e.$$.on_destroy.push((()=>l())),C();let h="";const{getStore:f}=k("store"),d=f();let p,y,v,g=!1;function m(){if(g){if(h!==s.title){let t={type:"Title",value:h};a.requestChange([t])}r(1,h=""),r(2,g=!1)}else console.log("Can't run saveTitle when it wasn't being edited!")}return e.$$.update=()=>{1&e.$$.dirty&&r(4,y=""===s.title)},r(7,i=d.activeSession),l(),l=c(i,(t=>r(15,a=t))),r(6,o=Us(d.activeSession,(t=>t.content))),u(),u=c(o,(t=>r(0,s=t))),[s,h,g,p,y,v,o,i,m,async function(){r(5,v=!1),r(1,h=s.title),r(2,g=!0),await(T(),O),p.focus()},function(){"Enter"==event.key?m():"Escape"==event.key&&(r(1,h=""),r(2,g=!1))},function(){h=this.value,r(1,h)},function(t){U[t?"unshift":"push"]((()=>{p=t,r(3,p)}))},()=>{r(5,v=!0)},()=>{r(5,v=!1)}]}class Ds extends X{constructor(t){super(),G(this,t,Ms,Rs,o,{})}}function zs(e){let n;return{c(){n=y("No connection")},m(t,e){f(t,n,e)},p:t,d(t){t&&d(n)}}}function Hs(t){let e,n,r=t[0].syn.Dna+"";return{c(){e=y("Connected to Dna: "),n=y(r)},m(t,r){f(t,e,r),f(t,n,r)},p(t,e){1&e&&r!==(r=t[0].syn.Dna+"")&&w(n,r)},d(t){t&&d(e),t&&d(n)}}}function Fs(e){let n,r,i,o,s,a,c,u,l,g,b,_,x,S,E,C,k,$,U,A=(e[1]?e[1].contentHashStr:"")+"",j=JSON.stringify(e[1])+"";function O(t,e){return t[0]&&t[0].syn?Hs:zs}let I=O(e),T=I(e);return{c(){n=p("div"),r=p("ul"),i=p("li"),T.c(),o=v(),s=p("li"),a=y("lastCommitedContentHash: "),c=y(A),u=v(),l=p("li"),g=y("session: "),b=y(j),_=v(),x=p("li"),S=y("nextIndex: "),E=y(e[2]),C=v(),k=p("li"),$=y("scribe: "),U=y(e[3]),m(r,"class","svelte-tgi576")},m(t,e){f(t,n,e),h(n,r),h(r,i),T.m(i,null),h(i,o),h(r,s),h(s,a),h(s,c),h(s,u),h(r,l),h(l,g),h(l,b),h(l,_),h(r,x),h(x,S),h(x,E),h(x,C),h(r,k),h(k,$),h(k,U)},p(t,[e]){I===(I=O(t))&&T?T.p(t,e):(T.d(1),T=I(t),T&&(T.c(),T.m(i,o))),2&e&&A!==(A=(t[1]?t[1].contentHashStr:"")+"")&&w(c,A),2&e&&j!==(j=JSON.stringify(t[1])+"")&&w(b,j),4&e&&w(E,t[2]),8&e&&w(U,t[3])},i:t,o:t,d(t){t&&d(n),T.d()}}}function qs(t,e,n){let r,i,o,s;return l(t,nt,(t=>n(0,r=t))),l(t,et,(t=>n(1,i=t))),l(t,at,(t=>n(2,o=t))),l(t,rt,(t=>n(3,s=t))),[r,i,o,s]}class Ns extends X{constructor(t){super(),G(this,t,qs,Fs,o,{})}}function Ws(e){let n,r,i;return{c(){n=p("div"),r=y(e[0]),m(n,"class",i="history-entry "+e[1]+" svelte-1led4hq")},m(t,e){f(t,n,e),h(n,r)},p(t,[e]){1&e&&w(r,t[0]),2&e&&i!==(i="history-entry "+t[1]+" svelte-1led4hq")&&m(n,"class",i)},i:t,o:t,d(t){t&&d(n)}}}function Vs(t,e,n){let{text:r}=e,{status:i}=e;return t.$$set=t=>{"text"in t&&n(0,r=t.text),"status"in t&&n(1,i=t.status)},[r,i]}class Ks extends X{constructor(t){super(),G(this,t,Vs,Ws,o,{text:0,status:1})}}function Zs(t,e,n){const r=t.slice();return r[9]=e[n],r}function Gs(t){let e,n;return e=new Ks({props:{status:t[9].status,text:t[9].text}}),{c(){V(e.$$.fragment)},m(t,r){K(e,t,r),n=!0},p(t,n){const r={};1&n&&(r.status=t[9].status),1&n&&(r.text=t[9].text),e.$set(r)},i(t){n||(q(e.$$.fragment,t),n=!0)},o(t){N(e.$$.fragment,t),n=!1},d(t){Z(e,t)}}}function Xs(t){let e,n,r,i,o=t[0],s=[];for(let e=0;e<o.length;e+=1)s[e]=Gs(Zs(t,o,e));const a=t=>N(s[t],1,1,(()=>{s[t]=null}));return{c(){e=p("div"),n=y("History:\n  "),r=p("div");for(let t=0;t<s.length;t+=1)s[t].c();m(r,"class","history-entries svelte-ywa4w4"),m(e,"class","history svelte-ywa4w4")},m(t,o){f(t,e,o),h(e,n),h(e,r);for(let t=0;t<s.length;t+=1)s[t].m(r,null);i=!0},p(t,[e]){if(1&e){let n;for(o=t[0],n=0;n<o.length;n+=1){const i=Zs(t,o,n);s[n]?(s[n].p(i,e),q(s[n],1)):(s[n]=Gs(i),s[n].c(),q(s[n],1),s[n].m(r,null))}for(H(),n=o.length;n<s.length;n+=1)a(n);F()}},i(t){if(!i){for(let t=0;t<o.length;t+=1)q(s[t]);i=!0}},o(t){s=s.filter(Boolean);for(let t=0;t<s.length;t+=1)N(s[t]);i=!1},d(t){t&&d(e),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(s,t)}}}function Js(t,e,n){let r,i,o;l(t,st,(t=>n(5,r=t))),l(t,ot,(t=>n(6,i=t))),l(t,it,(t=>n(7,o=t)));let s,a,c,{changeToTextFn:u}=e;function h(t,e){let n=[];for(let r=t.length-1;r>=0;r--){const i=u(t[r]);n.push({text:i,status:e})}return n}let f=[];var d;return d=async()=>{let t=document.getElementsByClassName("history-entries")[0];null!==t.firstChild&&t.firstChild.scrollIntoView(!1)},E().$$.after_update.push(d),t.$$set=t=>{"changeToTextFn"in t&&n(1,u=t.changeToTextFn)},t.$$.update=()=>{128&t.$$.dirty&&n(2,s=h(o,"requested")),64&t.$$.dirty&&n(3,a=h(i,"recorded")),32&t.$$.dirty&&n(4,c=h(r,"committed")),28&t.$$.dirty&&n(0,f=[...s,...a,...c])},[f,u,s,a,c,r,i,o]}class Ys extends X{constructor(t){super(),G(this,t,Js,Xs,o,{changeToTextFn:1})}}!function(t){t.Enabled="enabled",t.Disabled="disabled",t.Running="running",t.Stopped="stopped",t.Paused="paused"}(xs||(xs={}));var Qs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ta(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}function ea(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var na=null;"undefined"!=typeof WebSocket?na=WebSocket:"undefined"!=typeof MozWebSocket?na=MozWebSocket:void 0!==Qs?na=Qs.WebSocket||Qs.MozWebSocket:"undefined"!=typeof window?na=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(na=self.WebSocket||self.MozWebSocket);var ra=na,ia="undefined"!=typeof process&&"never"!==process.env.TEXT_ENCODING&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder,oa=4294967295;function sa(t){for(var e=t.length,n=0,r=0;r<e;){var i=t.charCodeAt(r++);if(0!=(4294967168&i))if(0==(4294965248&i))n+=2;else{if(i>=55296&&i<=56319&&r<e){var o=t.charCodeAt(r);56320==(64512&o)&&(++r,i=((1023&i)<<10)+(1023&o)+65536)}n+=0==(4294901760&i)?3:4}else n++}return n}var aa=ia?new TextEncoder:void 0,ca=ia?"undefined"!=typeof process&&"force"!==process.env.TEXT_ENCODING?200:0:oa;var ua=(null==aa?void 0:aa.encodeInto)?function(t,e,n){aa.encodeInto(t,e.subarray(n))}:function(t,e,n){e.set(aa.encode(t),n)};function la(t,e,n){for(var r=e,i=r+n,o=[],s="";r<i;){var a=t[r++];if(0==(128&a))o.push(a);else if(192==(224&a)){var c=63&t[r++];o.push((31&a)<<6|c)}else if(224==(240&a)){c=63&t[r++];var u=63&t[r++];o.push((31&a)<<12|c<<6|u)}else if(240==(248&a)){var l=(7&a)<<18|(c=63&t[r++])<<12|(u=63&t[r++])<<6|63&t[r++];l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l)}else o.push(a);o.length>=4096&&(s+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(s+=String.fromCharCode.apply(String,o)),s}var ha=ia?new TextDecoder:null,fa=ia?"undefined"!=typeof process&&"force"!==process.env.TEXT_DECODER?200:0:oa;var da=function(t,e){this.type=t,this.data=e};function pa(t,e,n){var r=Math.floor(n/4294967296),i=n;t.setUint32(e,r),t.setUint32(e+4,i)}function ya(t,e){return 4294967296*t.getInt32(e)+t.getUint32(e+4)}var va={type:-1,encode:function(t){var e,n,r,i;return t instanceof Date?function(t){var e,n=t.sec,r=t.nsec;if(n>=0&&r>=0&&n<=17179869183){if(0===r&&n<=4294967295){var i=new Uint8Array(4);return(e=new DataView(i.buffer)).setUint32(0,n),i}var o=n/4294967296,s=4294967295&n;return i=new Uint8Array(8),(e=new DataView(i.buffer)).setUint32(0,r<<2|3&o),e.setUint32(4,s),i}return i=new Uint8Array(12),(e=new DataView(i.buffer)).setUint32(0,r),pa(e,4,n),i}((e=t.getTime(),n=Math.floor(e/1e3),r=1e6*(e-1e3*n),i=Math.floor(r/1e9),{sec:n+i,nsec:r-1e9*i})):null},decode:function(t){var e=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:var n=e.getUint32(0);return{sec:4294967296*(3&n)+e.getUint32(4),nsec:n>>>2};case 12:return{sec:ya(e,4),nsec:e.getUint32(0)};default:throw new Error("Unrecognized data size for timestamp: "+t.length)}}(t);return new Date(1e3*e.sec+e.nsec/1e6)}},ga=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(va)}return t.prototype.register=function(t){var e=t.type,n=t.encode,r=t.decode;if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{var i=1+e;this.builtInEncoders[i]=n,this.builtInDecoders[i]=r}},t.prototype.tryToEncode=function(t,e){for(var n=0;n<this.builtInEncoders.length;n++){if(null!=(r=this.builtInEncoders[n]))if(null!=(i=r(t,e)))return new da(-1-n,i)}for(n=0;n<this.encoders.length;n++){var r,i;if(null!=(r=this.encoders[n]))if(null!=(i=r(t,e)))return new da(n,i)}return t instanceof da?t:null},t.prototype.decode=function(t,e,n){var r=e<0?this.builtInDecoders[-1-e]:this.decoders[e];return r?r(t,e,n):new da(e,t)},t.defaultCodec=new t,t}();function ma(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}var ba=function(){function t(t,e,n,r,i,o,s,a){void 0===t&&(t=ga.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=100),void 0===r&&(r=2048),void 0===i&&(i=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===a&&(a=!1),this.extensionCodec=t,this.context=e,this.maxDepth=n,this.initialBufferSize=r,this.sortKeys=i,this.forceFloat32=o,this.ignoreUndefined=s,this.forceIntegerToFloat=a,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encode=function(t){return this.reinitializeState(),this.doEncode(t,1),this.getUint8Array()},t.prototype.doEncode=function(t,e){if(e>this.maxDepth)throw new Error("Too deep objects in depth "+e);null==t?this.encodeNil():"boolean"==typeof t?this.encodeBoolean(t):"number"==typeof t?this.encodeNumber(t):"string"==typeof t?this.encodeString(t):this.encodeObject(t,e)},t.prototype.ensureBufferSizeToWrite=function(t){var e=this.pos+t;this.view.byteLength<e&&this.resizeBuffer(2*e)},t.prototype.resizeBuffer=function(t){var e=new ArrayBuffer(t),n=new Uint8Array(e),r=new DataView(e);n.set(this.bytes),this.view=r,this.bytes=n},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(t){!1===t?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(t){Number.isSafeInteger(t)&&!this.forceIntegerToFloat?t>=0?t<128?this.writeU8(t):t<256?(this.writeU8(204),this.writeU8(t)):t<65536?(this.writeU8(205),this.writeU16(t)):t<4294967296?(this.writeU8(206),this.writeU32(t)):(this.writeU8(207),this.writeU64(t)):t>=-32?this.writeU8(224|t+32):t>=-128?(this.writeU8(208),this.writeI8(t)):t>=-32768?(this.writeU8(209),this.writeI16(t)):t>=-2147483648?(this.writeU8(210),this.writeI32(t)):(this.writeU8(211),this.writeI64(t)):this.forceFloat32?(this.writeU8(202),this.writeF32(t)):(this.writeU8(203),this.writeF64(t))},t.prototype.writeStringHeader=function(t){if(t<32)this.writeU8(160+t);else if(t<256)this.writeU8(217),this.writeU8(t);else if(t<65536)this.writeU8(218),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too long string: "+t+" bytes in UTF-8");this.writeU8(219),this.writeU32(t)}},t.prototype.encodeString=function(t){if(t.length>ca){var e=sa(t);this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),ua(t,this.bytes,this.pos),this.pos+=e}else{e=sa(t);this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),function(t,e,n){for(var r=t.length,i=n,o=0;o<r;){var s=t.charCodeAt(o++);if(0!=(4294967168&s)){if(0==(4294965248&s))e[i++]=s>>6&31|192;else{if(s>=55296&&s<=56319&&o<r){var a=t.charCodeAt(o);56320==(64512&a)&&(++o,s=((1023&s)<<10)+(1023&a)+65536)}0==(4294901760&s)?(e[i++]=s>>12&15|224,e[i++]=s>>6&63|128):(e[i++]=s>>18&7|240,e[i++]=s>>12&63|128,e[i++]=s>>6&63|128)}e[i++]=63&s|128}else e[i++]=s}}(t,this.bytes,this.pos),this.pos+=e}},t.prototype.encodeObject=function(t,e){var n=this.extensionCodec.tryToEncode(t,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(t))this.encodeArray(t,e);else if(ArrayBuffer.isView(t))this.encodeBinary(t);else{if("object"!=typeof t)throw new Error("Unrecognized object: "+Object.prototype.toString.apply(t));this.encodeMap(t,e)}},t.prototype.encodeBinary=function(t){var e=t.byteLength;if(e<256)this.writeU8(196),this.writeU8(e);else if(e<65536)this.writeU8(197),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large binary: "+e);this.writeU8(198),this.writeU32(e)}var n=ma(t);this.writeU8a(n)},t.prototype.encodeArray=function(t,e){var n=t.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else{if(!(n<4294967296))throw new Error("Too large array: "+n);this.writeU8(221),this.writeU32(n)}for(var r=0,i=t;r<i.length;r++){var o=i[r];this.doEncode(o,e+1)}},t.prototype.countWithoutUndefined=function(t,e){for(var n=0,r=0,i=e;r<i.length;r++){void 0!==t[i[r]]&&n++}return n},t.prototype.encodeMap=function(t,e){var n=Object.keys(t);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(t,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large map object: "+r);this.writeU8(223),this.writeU32(r)}for(var i=0,o=n;i<o.length;i++){var s=o[i],a=t[s];this.ignoreUndefined&&void 0===a||(this.encodeString(s),this.doEncode(a,e+1))}},t.prototype.encodeExtension=function(t){var e=t.data.length;if(1===e)this.writeU8(212);else if(2===e)this.writeU8(213);else if(4===e)this.writeU8(214);else if(8===e)this.writeU8(215);else if(16===e)this.writeU8(216);else if(e<256)this.writeU8(199),this.writeU8(e);else if(e<65536)this.writeU8(200),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large extension object: "+e);this.writeU8(201),this.writeU32(e)}this.writeI8(t.type),this.writeU8a(t.data)},t.prototype.writeU8=function(t){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,t),this.pos++},t.prototype.writeU8a=function(t){var e=t.length;this.ensureBufferSizeToWrite(e),this.bytes.set(t,this.pos),this.pos+=e},t.prototype.writeI8=function(t){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,t),this.pos++},t.prototype.writeU16=function(t){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,t),this.pos+=2},t.prototype.writeI16=function(t){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,t),this.pos+=2},t.prototype.writeU32=function(t){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,t),this.pos+=4},t.prototype.writeI32=function(t){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,t),this.pos+=4},t.prototype.writeF32=function(t){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,t),this.pos+=4},t.prototype.writeF64=function(t){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,t),this.pos+=8},t.prototype.writeU64=function(t){this.ensureBufferSizeToWrite(8),function(t,e,n){var r=n/4294967296,i=n;t.setUint32(e,r),t.setUint32(e+4,i)}(this.view,this.pos,t),this.pos+=8},t.prototype.writeI64=function(t){this.ensureBufferSizeToWrite(8),pa(this.view,this.pos,t),this.pos+=8},t}(),wa={};function _a(t,e){return void 0===e&&(e=wa),new ba(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat).encode(t)}function xa(t){return(t<0?"-":"")+"0x"+Math.abs(t).toString(16).padStart(2,"0")}var Sa=function(){function t(t,e){void 0===t&&(t=16),void 0===e&&(e=16),this.maxKeyLength=t,this.maxLengthPerKey=e,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return t.prototype.canBeCached=function(t){return t>0&&t<=this.maxKeyLength},t.prototype.get=function(t,e,n){t:for(var r=0,i=this.caches[n-1];r<i.length;r++){for(var o=i[r],s=o.bytes,a=0;a<n;a++)if(s[a]!==t[e+a])continue t;return o.value}return null},t.prototype.store=function(t,e){var n=this.caches[t.length-1],r={bytes:t,value:e};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},t.prototype.decode=function(t,e,n){var r=this.get(t,e,n);if(null!=r)return this.hit++,r;this.miss++;var i=la(t,e,n),o=Uint8Array.prototype.slice.call(t,e,e+n);return this.store(o,i),i},t}(),Ea=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},Ca=function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},ka=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}},$a=function(t){return this instanceof $a?(this.v=t,this):new $a(t)},Ua=function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||a(t,e)}))})}function a(t,e){try{!function(t){t.value instanceof $a?Promise.resolve(t.value.v).then(c,u):l(o[0][2],t)}(i[t](e))}catch(t){l(o[0][3],t)}}function c(t){a("next",t)}function u(t){a("throw",t)}function l(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}},Aa=new DataView(new ArrayBuffer(0)),ja=new Uint8Array(Aa.buffer),Oa=function(){try{Aa.getInt8(0)}catch(t){return t.constructor}throw new Error("never reached")}(),Ia=new Oa("Insufficient data"),Ta=4294967295,Pa=new Sa,La=function(){function t(t,e,n,r,i,o,s,a){void 0===t&&(t=ga.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=Ta),void 0===r&&(r=Ta),void 0===i&&(i=Ta),void 0===o&&(o=Ta),void 0===s&&(s=Ta),void 0===a&&(a=Pa),this.extensionCodec=t,this.context=e,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=i,this.maxMapLength=o,this.maxExtLength=s,this.keyDecoder=a,this.totalPos=0,this.pos=0,this.view=Aa,this.bytes=ja,this.headByte=-1,this.stack=[]}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1},t.prototype.setBuffer=function(t){this.bytes=ma(t),this.view=function(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=ma(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}(this.bytes),this.pos=0},t.prototype.appendBuffer=function(t){if(-1!==this.headByte||this.hasRemaining()){var e=this.bytes.subarray(this.pos),n=ma(t),r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),this.setBuffer(r)}else this.setBuffer(t)},t.prototype.hasRemaining=function(t){return void 0===t&&(t=1),this.view.byteLength-this.pos>=t},t.prototype.createExtraByteError=function(t){var e=this.view,n=this.pos;return new RangeError("Extra "+(e.byteLength-n)+" of "+e.byteLength+" byte(s) found at buffer["+t+"]")},t.prototype.decode=function(t){this.reinitializeState(),this.setBuffer(t);var e=this.doDecodeSync();if(this.hasRemaining())throw this.createExtraByteError(this.pos);return e},t.prototype.decodeMulti=function(t){return Ca(this,(function(e){switch(e.label){case 0:this.reinitializeState(),this.setBuffer(t),e.label=1;case 1:return this.hasRemaining()?[4,this.doDecodeSync()]:[3,3];case 2:return e.sent(),[3,1];case 3:return[2]}}))},t.prototype.decodeAsync=function(t){var e,n,r,i;return Ea(this,void 0,void 0,(function(){var o,s,a,c,u,l,h,f;return Ca(this,(function(d){switch(d.label){case 0:o=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),e=ka(t),d.label=2;case 2:return[4,e.next()];case 3:if((n=d.sent()).done)return[3,5];if(a=n.value,o)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{s=this.doDecodeSync(),o=!0}catch(t){if(!(t instanceof Oa))throw t}this.totalPos+=this.pos,d.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return c=d.sent(),r={error:c},[3,12];case 7:return d.trys.push([7,,10,11]),n&&!n.done&&(i=e.return)?[4,i.call(e)]:[3,9];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(o){if(this.hasRemaining())throw this.createExtraByteError(this.totalPos);return[2,s]}throw l=(u=this).headByte,h=u.pos,f=u.totalPos,new RangeError("Insufficient data in parsing "+xa(l)+" at "+f+" ("+h+" in the current buffer)")}}))}))},t.prototype.decodeArrayStream=function(t){return this.decodeMultiAsync(t,!0)},t.prototype.decodeStream=function(t){return this.decodeMultiAsync(t,!1)},t.prototype.decodeMultiAsync=function(t,e){return Ua(this,arguments,(function(){var n,r,i,o,s,a,c,u,l;return Ca(this,(function(h){switch(h.label){case 0:n=e,r=-1,h.label=1;case 1:h.trys.push([1,13,14,19]),i=ka(t),h.label=2;case 2:return[4,$a(i.next())];case 3:if((o=h.sent()).done)return[3,12];if(s=o.value,e&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),n&&(r=this.readArraySize(),n=!1,this.complete()),h.label=4;case 4:h.trys.push([4,9,,10]),h.label=5;case 5:return[4,$a(this.doDecodeSync())];case 6:return[4,h.sent()];case 7:return h.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((a=h.sent())instanceof Oa))throw a;return[3,10];case 10:this.totalPos+=this.pos,h.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c=h.sent(),u={error:c},[3,19];case 14:return h.trys.push([14,,17,18]),o&&!o.done&&(l=i.return)?[4,$a(l.call(i))]:[3,16];case 15:h.sent(),h.label=16;case 16:return[3,18];case 17:if(u)throw u.error;return[7];case 18:return[7];case 19:return[2]}}))}))},t.prototype.doDecodeSync=function(){t:for(;;){var t=this.readHeadByte(),e=void 0;if(t>=224)e=t-256;else if(t<192)if(t<128)e=t;else if(t<144){if(0!==(r=t-128)){this.pushMapState(r),this.complete();continue t}e={}}else if(t<160){if(0!==(r=t-144)){this.pushArrayState(r),this.complete();continue t}e=[]}else{var n=t-160;e=this.decodeUtf8String(n,0)}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.readI64();else if(217===t){n=this.lookU8();e=this.decodeUtf8String(n,1)}else if(218===t){n=this.lookU16();e=this.decodeUtf8String(n,2)}else if(219===t){n=this.lookU32();e=this.decodeUtf8String(n,4)}else if(220===t){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(221===t){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(222===t){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue t}e={}}else if(223===t){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue t}e={}}else if(196===t){var r=this.lookU8();e=this.decodeBinary(r,1)}else if(197===t){r=this.lookU16();e=this.decodeBinary(r,2)}else if(198===t){r=this.lookU32();e=this.decodeBinary(r,4)}else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t){r=this.lookU8();e=this.decodeExtension(r,1)}else if(200===t){r=this.lookU16();e=this.decodeExtension(r,2)}else{if(201!==t)throw new Error("Unrecognized type byte: "+xa(t));r=this.lookU32();e=this.decodeExtension(r,4)}this.complete();for(var i=this.stack;i.length>0;){var o=i[i.length-1];if(0===o.type){if(o.array[o.position]=e,o.position++,o.position!==o.size)continue t;i.pop(),e=o.array}else{if(1===o.type){if(s=void 0,"string"!==(s=typeof e)&&"number"!==s)throw new Error("The type of key must be string or number but "+typeof e);o.key=e,o.type=2;continue t}if(o.map[o.key]=e,o.readCount++,o.readCount!==o.size){o.key=null,o.type=1;continue t}i.pop(),e=o.map}}return e}var s},t.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=-1},t.prototype.readArraySize=function(){var t=this.readHeadByte();switch(t){case 220:return this.readU16();case 221:return this.readU32();default:if(t<160)return t-144;throw new Error("Unrecognized array type byte: "+xa(t))}},t.prototype.pushMapState=function(t){if(t>this.maxMapLength)throw new Error("Max length exceeded: map length ("+t+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:t,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(t){if(t>this.maxArrayLength)throw new Error("Max length exceeded: array length ("+t+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:t,array:new Array(t),position:0})},t.prototype.decodeUtf8String=function(t,e){var n;if(t>this.maxStrLength)throw new Error("Max length exceeded: UTF-8 byte length ("+t+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+e+t)throw Ia;var r,i=this.pos+e;return r=this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(t))?this.keyDecoder.decode(this.bytes,i,t):t>fa?function(t,e,n){var r=t.subarray(e,e+n);return ha.decode(r)}(this.bytes,i,t):la(this.bytes,i,t),this.pos+=e+t,r},t.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},t.prototype.decodeBinary=function(t,e){if(t>this.maxBinLength)throw new Error("Max length exceeded: bin length ("+t+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(t+e))throw Ia;var n=this.pos+e,r=this.bytes.subarray(n,n+t);return this.pos+=e+t,r},t.prototype.decodeExtension=function(t,e){if(t>this.maxExtLength)throw new Error("Max length exceeded: ext length ("+t+") > maxExtLength ("+this.maxExtLength+")");var n=this.view.getInt8(this.pos+e),r=this.decodeBinary(t,e+1);return this.extensionCodec.decode(r,n,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var t=this.view.getUint8(this.pos);return this.pos++,t},t.prototype.readI8=function(){var t=this.view.getInt8(this.pos);return this.pos++,t},t.prototype.readU16=function(){var t=this.view.getUint16(this.pos);return this.pos+=2,t},t.prototype.readI16=function(){var t=this.view.getInt16(this.pos);return this.pos+=2,t},t.prototype.readU32=function(){var t=this.view.getUint32(this.pos);return this.pos+=4,t},t.prototype.readI32=function(){var t=this.view.getInt32(this.pos);return this.pos+=4,t},t.prototype.readU64=function(){var t,e,n=(t=this.view,e=this.pos,4294967296*t.getUint32(e)+t.getUint32(e+4));return this.pos+=8,n},t.prototype.readI64=function(){var t=ya(this.view,this.pos);return this.pos+=8,t},t.prototype.readF32=function(){var t=this.view.getFloat32(this.pos);return this.pos+=4,t},t.prototype.readF64=function(){var t=this.view.getFloat64(this.pos);return this.pos+=8,t},t}(),Ba={};function Ra(t,e){return void 0===e&&(e=Ba),new La(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength).decode(t)}var Ma=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class Da{constructor(t,e){this.socket=t,this.pendingRequests={},this.index=0,this.alreadyWarnedNoSignalCb=!1,t.onmessage=t=>Ma(this,void 0,void 0,(function*(){let n=t.data;"undefined"!=typeof Buffer&&Buffer.isBuffer(n)||(n=yield n.arrayBuffer());const r=Ra(n);if("Signal"===r.type)if(e){const t=Ra(r.data),n=t.App[0],i=za(t.App[1]),o={type:r.type,data:{cellId:n,payload:i}};e(o)}else this.alreadyWarnedNoSignalCb||console.log("Received signal but no signal callback was set in constructor"),this.alreadyWarnedNoSignalCb=!0;else"Response"===r.type?this.handleResponse(r):console.error(`Got unrecognized Websocket message type: ${r.type}`)}))}emitSignal(t){const e=_a({type:"Signal",data:_a(t)});this.socket.send(e)}request(t){let e=this.index;this.index+=1;const n=_a({id:e,type:"Request",data:_a(t)}),r=new Promise(((t,n)=>{this.pendingRequests[e]={fulfill:t,reject:n}}));return this.socket.readyState!==this.socket.OPEN?Promise.reject(new Error("Socket is not open")):(this.socket.send(n),r)}handleResponse(t){const e=t.id;this.pendingRequests[e]?null===t.data||void 0===t.data?this.pendingRequests[e].reject(new Error("Response canceled by responder")):this.pendingRequests[e].fulfill(Ra(t.data)):console.error(`Got response with no matching request. id=${e}`)}close(){return this.socket.close(),this.awaitClose()}awaitClose(){return new Promise((t=>this.socket.on("close",t)))}static connect(t,e){return new Promise(((n,r)=>{const i=new ra(t);i.onerror=e=>{r(new Error(`could not connect to holochain conductor, please check that a conductor service is running and available at ${t}`))},i.onopen=()=>{n(new Da(i,e))}}))}}const za=t=>Ra(t),Ha=t=>"error"===t.type?Promise.reject(t):Promise.resolve(t);var Fa=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};const qa=t=>t,Na={input:qa,output:qa};var Wa=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class Va{constructor(t,e){this._requester=(t,e)=>((t,e,n=Na)=>(r,i)=>Fa(void 0,void 0,void 0,(function*(){const o={type:e,data:n.input(r)},s=yield t(o,i);return n.output(s.data)})))(((e,n)=>((t,e,n)=>{let r,i=new Promise(((t,i)=>{r=setTimeout((()=>{clearTimeout(r),i(new Error(`Timed out in ${n}ms: ${e}`))}),n)}));return new Promise(((e,n)=>{Promise.race([t,i]).then((t=>(clearTimeout(r),e(t)))).catch((t=>n(t)))}))})(this.client.request(e),t,n||this.defaultTimeout).then(Ha)),t,e),this.appInfo=this._requester("app_info"),this.callZome=this._requester("zome_call_invocation",Ka),this.client=t,this.defaultTimeout=void 0===e?15e3:e}static connect(t,e,n){return Wa(this,void 0,void 0,(function*(){const r=yield Da.connect(t,n);return new Va(r,e)}))}}const Ka={input:t=>Object.assign(Object.assign({},t),{payload:_a(t.payload)}),output:t=>Ra(t)};
/**
      postmate - A powerful, simple, promise-based postMessage library
      @version v1.5.2
      @link https://github.com/dollarshaveclub/postmate
      @author Jacob Kelley <jakie8@gmail.com>
      @license MIT
    **/var Za="application/x-postmate-v1+json",Ga=0,Xa=function(){var t;return ec.debug?(t=console).log.apply(t,arguments):null},Ja={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},Ya=function(t,e){return("string"!=typeof e||t.origin===e)&&(!!t.data&&(("object"!=typeof t.data||"postmate"in t.data)&&(t.data.type===Za&&!!Ja[t.data.postmate])))},Qa=function(){function t(t){var e=this;this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.events={},Xa("Parent: Registering API"),Xa("Parent: Awaiting messages..."),this.listener=function(t){if(!Ya(t,e.childOrigin))return!1;var n=((t||{}).data||{}).value||{},r=n.data,i=n.name;"emit"===t.data.postmate&&(Xa("Parent: Received event emission: "+i),i in e.events&&e.events[i].call(e,r))},this.parent.addEventListener("message",this.listener,!1),Xa("Parent: Awaiting event emissions from Child")}var e=t.prototype;return e.get=function(t){var e=this;return new ec.Promise((function(n){var r=++Ga;e.parent.addEventListener("message",(function t(i){i.data.uid===r&&"reply"===i.data.postmate&&(e.parent.removeEventListener("message",t,!1),n(i.data.value))}),!1),e.child.postMessage({postmate:"request",type:Za,property:t,uid:r},e.childOrigin)}))},e.call=function(t,e){this.child.postMessage({postmate:"call",type:Za,property:t,data:e},this.childOrigin)},e.on=function(t,e){this.events[t]=e},e.destroy=function(){Xa("Parent: Destroying Postmate instance"),window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)},t}(),tc=function(){function t(t){var e=this;this.model=t.model,this.parent=t.parent,this.parentOrigin=t.parentOrigin,this.child=t.child,Xa("Child: Registering API"),Xa("Child: Awaiting messages..."),this.child.addEventListener("message",(function(t){if(Ya(t,e.parentOrigin)){Xa("Child: Received request",t.data);var n=t.data,r=n.property,i=n.uid,o=n.data;"call"!==t.data.postmate?function(t,e){var n="function"==typeof t[e]?t[e]():t[e];return ec.Promise.resolve(n)}(e.model,r).then((function(e){return t.source.postMessage({property:r,postmate:"reply",type:Za,uid:i,value:e},t.origin)})):r in e.model&&"function"==typeof e.model[r]&&e.model[r](o)}}))}return t.prototype.emit=function(t,e){Xa('Child: Emitting Event "'+t+'"',e),this.parent.postMessage({postmate:"emit",type:Za,value:{name:t,data:e}},this.parentOrigin)},t}(),ec=function(){function t(t){var e=t.container,n=void 0===e?void 0!==n?n:document.body:e,r=t.model,i=t.url,o=t.name,s=t.classListArray,a=void 0===s?[]:s;return this.parent=window,this.frame=document.createElement("iframe"),this.frame.name=o||"",this.frame.classList.add.apply(this.frame.classList,a),n.appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=r||{},this.sendHandshake(i)}return t.prototype.sendHandshake=function(e){var n,r=this,i=function(t){var e=document.createElement("a");e.href=t;var n=e.protocol.length>4?e.protocol:window.location.protocol,r=e.host.length?"80"===e.port||"443"===e.port?e.hostname:e.host:window.location.host;return e.origin||n+"//"+r}(e),o=0;return new t.Promise((function(t,s){r.parent.addEventListener("message",(function e(o){return!!Ya(o,i)&&("handshake-reply"===o.data.postmate?(clearInterval(n),Xa("Parent: Received handshake reply from Child"),r.parent.removeEventListener("message",e,!1),r.childOrigin=o.origin,Xa("Parent: Saving Child origin",r.childOrigin),t(new Qa(r))):(Xa("Parent: Invalid handshake reply"),s("Failed handshake")))}),!1);var a=function(){o++,Xa("Parent: Sending handshake attempt "+o,{childOrigin:i}),r.child.postMessage({postmate:"handshake",type:Za,model:r.model},i),5===o&&clearInterval(n)},c=function(){a(),n=setInterval(a,500)};r.frame.attachEvent?r.frame.attachEvent("onload",c):r.frame.onload=c,Xa("Parent: Loading frame",{url:e}),r.frame.src=e}))},t}();ec.debug=!1,ec.Promise=function(){try{return window?window.Promise:Promise}catch(t){return null}}(),ec.Model=function(){function t(t){return this.child=window,this.model=t,this.parent=this.child.parent,this.sendHandshakeReply()}return t.prototype.sendHandshakeReply=function(){var t=this;return new ec.Promise((function(e,n){t.child.addEventListener("message",(function r(i){if(i.data.postmate){if("handshake"===i.data.postmate){Xa("Child: Received handshake from Parent"),t.child.removeEventListener("message",r,!1),Xa("Child: Sending handshake reply to Parent"),i.source.postMessage({postmate:"handshake-reply",type:Za},i.origin),t.parentOrigin=i.origin;var o=i.data.model;return o&&(Object.keys(o).forEach((function(e){t.model[e]=o[e]})),Xa("Child: Inherited and extended model from Parent")),Xa("Child: Saving Parent origin",t.parentOrigin),e(new tc(t))}return n("Handshake Reply Failed")}}),!1)}))},t}();var nc=Object.freeze({__proto__:null,default:ec}),rc=ta((function(t,e){var n=Qs&&Qs.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),r=Qs&&Qs.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},i=Qs&&Qs.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};e.__esModule=!0;var o=function(t){function e(n,r){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=t.call(this,n)||this;return Error.captureStackTrace&&Error.captureStackTrace(s,e),s.name="TimeoutError",s.timeout=r,s}return n(e,t),e}(Error);e.TimeoutError=o,e.default=function(t,e){var n=this;return void 0===e&&(e=2e3),new Promise((function(s,a){return r(n,void 0,void 0,(function(){var n,r,c;return i(this,(function(i){switch(i.label){case 0:n=setTimeout((function(){a(new o("Waited for "+e/1e3+" seconds",e))}),e),i.label=1;case 1:return i.trys.push([1,3,4,5]),[4,t()];case 2:return r=i.sent(),s(r),[3,5];case 3:return c=i.sent(),a(c),[3,5];case 4:return clearTimeout(n),[7];case 5:return[2]}}))}))}))}})),ic=ea(nc),oc=ta((function(t,e){var n=Qs&&Qs.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},r=Qs&&Qs.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},i=Qs&&Qs.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};e.__esModule=!0;var o=i(ic),s=i(rc),a=rc,c={debug:function(t){o.default.debug=!0},connect:function(t,e,i){return n(this,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,(n=new u(t,e,i)).connect()];case 1:return r.sent(),[2,n]}}))}))},listen:function(t){return n(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return[4,(e=new l(t)).connect()];case 1:return n.sent(),[2,e]}}))}))}};e.COMB=c;var u=function(){function t(e,i,a){var c=this;void 0===i&&(i=5e3),this.url=e,this.msg_count=0,this.responses={},this.loaded=!1,this.signalCb=a,this.class_name="comb-frame-"+t.frame_count++,this.handshake=s.default((function(){return n(c,void 0,void 0,(function(){var t,e=this;return r(this,(function(n){switch(n.label){case 0:return t=new o.default({container:document.body,url:this.url,classListArray:[this.class_name]}),document.querySelector("iframe."+this.class_name).contentWindow.addEventListener("domcontentloaded",(function(){e.loaded=!0})),[4,t];case 1:return[2,n.sent()]}}))}))}),i)}return t.prototype.connect=function(){return n(this,void 0,void 0,(function(){var t,e,n=this;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.handshake];case 1:return t=r.sent(),[3,3];case 2:throw"TimeoutError"===(e=r.sent()).name?this.loaded?new a.TimeoutError("Failed to complete COMB handshake",e.timeout):new a.TimeoutError("Failed to load iFrame",e.timeout):e;case 3:return t.on("response",(function(t){var e=t[0],r=t[1],i=n.responses[e],o=i[0],s=i[1];r instanceof Error?s(r):o(r),delete n.responses[e]})),this.signalCb&&t.on("signal",this.signalCb),this.msg_bus=t,[2,this]}}))}))},t.prototype.request=function(t,e,i,o){var a=this;void 0===o&&(o=2e3);var c=this.msg_count++;return this.msg_bus.call(t,[c,e,i]),s.default((function(){return n(a,void 0,void 0,(function(){var t=this;return r(this,(function(e){switch(e.label){case 0:return[4,new Promise((function(e,n){t.responses[c]=[e,n]}))];case 1:return[2,e.sent()]}}))}))}),o)},t.prototype.set=function(t,e){return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,this.request("prop",t,e)];case 1:return[2,n.sent()]}}))}))},t.prototype.run=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,this.request("exec",t,e)];case 1:return[2,n.sent()]}}))}))},t.prototype.call=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return n(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return[4,this.request("exec",t,e,84e6)];case 1:return[2,n.sent()]}}))}))},t.frame_count=0,t}(),l=function(){function t(t,e){var i=this;void 0===e&&(e={}),this.methods=t,this.properties=e,this.listener=new o.default.Model({exec:function(t){return n(i,void 0,void 0,(function(){var e,n,i,o,s;return r(this,(function(r){switch(r.label){case 0:return e=t[0],n=t[1],i=t[2],void 0===(o=this.methods[n])?[2,this.msg_bus.emit("response",[e,new Error("Method '"+n+"' does not exist")])]:"function"!=typeof o?[2,this.msg_bus.emit("response",[e,new Error("Method '"+n+"' is not a function. Found type '"+typeof o+"'")])]:[4,o.apply(this.properties,i)];case 1:return s=r.sent(),this.msg_bus.emit("response",[e,s]),[2]}}))}))},prop:function(t){return n(i,void 0,void 0,(function(){var e,n,i;return r(this,(function(r){return e=t[0],n=t[1],i=t[2],this.properties[n]=i,this.msg_bus.emit("response",[e,!0]),[2]}))}))}})}return t.prototype.connect=function(){return n(this,void 0,void 0,(function(){var t;return r(this,(function(e){switch(e.label){case 0:return t=this,[4,this.listener];case 1:return t.msg_bus=e.sent(),[2,this]}}))}))},t.prototype.sendSignal=function(t){return n(this,void 0,void 0,(function(){return r(this,(function(e){return this.msg_bus.emit("signal",t),[2]}))}))},t}()}));function sc(){}function ac(){ac.init.call(this)}function cc(t){return void 0===t._maxListeners?ac.defaultMaxListeners:t._maxListeners}function uc(t,e,n){if(e)t.call(n);else for(var r=t.length,i=gc(t,r),o=0;o<r;++o)i[o].call(n)}function lc(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=gc(t,i),s=0;s<i;++s)o[s].call(n,r)}function hc(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=gc(t,o),a=0;a<o;++a)s[a].call(n,r,i)}function fc(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,a=gc(t,s),c=0;c<s;++c)a[c].call(n,r,i,o)}function dc(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=gc(t,i),s=0;s<i;++s)o[s].apply(n,r)}function pc(t,e,n,r){var i,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=new sc,t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=cc(t))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,function(t){"function"==typeof console.warn?console.warn(t):console.log(t)}(a)}}else s=o[e]=n,++t._eventsCount;return t}function yc(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}function vc(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function gc(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}sc.prototype=Object.create(null),ac.EventEmitter=ac,ac.usingDomains=!1,ac.prototype.domain=void 0,ac.prototype._events=void 0,ac.prototype._maxListeners=void 0,ac.defaultMaxListeners=10,ac.init=function(){this.domain=null,ac.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new sc,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ac.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},ac.prototype.getMaxListeners=function(){return cc(this)},ac.prototype.emit=function(t){var e,n,r,i,o,s,a,c="error"===t;if(s=this._events)c=c&&null==s.error;else if(!c)return!1;if(a=this.domain,c){if(e=arguments[1],!a){if(e instanceof Error)throw e;var u=new Error('Uncaught, unspecified "error" event. ('+e+")");throw u.context=e,u}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(n=s[t]))return!1;var l="function"==typeof n;switch(r=arguments.length){case 1:uc(n,l,this);break;case 2:lc(n,l,this,arguments[1]);break;case 3:hc(n,l,this,arguments[1],arguments[2]);break;case 4:fc(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];dc(n,l,this,i)}return!0},ac.prototype.addListener=function(t,e){return pc(this,t,e,!1)},ac.prototype.on=ac.prototype.addListener,ac.prototype.prependListener=function(t,e){return pc(this,t,e,!0)},ac.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,yc(this,t,e)),this},ac.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,yc(this,t,e)),this},ac.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new sc:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new sc,this;delete r[t]}else!function(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}(n,i);r.removeListener&&this.emit("removeListener",t,s||e)}return this},ac.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new sc,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new sc:delete n[t]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new sc,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},ac.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(e):[]},ac.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):vc.call(t,e)},ac.prototype.listenerCount=vc,ac.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var mc=ea(Object.freeze({__proto__:null,default:ac,EventEmitter:ac}));const bc=void 0!==Qs.COMB,wc=Qs.COMB||oc.COMB,{EventEmitter:_c}=mc;class xc extends _c{constructor(t,e,n){super();const r=window.location.hostname;this.chaperone_url=new URL(t||`http://${r}:24273`),void 0!==n&&(void 0!==n.logo_url&&this.chaperone_url.searchParams.set("logo_url",function(t){return new URL(t,window.location).href}(n.logo_url)),void 0!==n.app_name&&this.chaperone_url.searchParams.set("app_name",n.app_name),void 0!==n.info_link&&this.chaperone_url.searchParams.set("info_link",n.info_link),void 0!==n.publisher_name&&this.chaperone_url.searchParams.set("publisher_name",n.publisher_name)),this.waiting=[],this.child=null,this.signalCb=e,this.connecting=this.connect()}ready(){return new Promise(((t,e)=>{this.connecting.catch(e),null!==this.child?t():this.waiting.push(t)}))}async connect(){try{this.child=await wc.connect(this.chaperone_url.href,5e3,this.signalCb)}catch(t){throw"TimeoutError"===t.name&&console.log("Chaperone did not load properly. Is it running?"),t}let t;for(;t=this.waiting.shift();)t();if(bc)return;this.child.msg_bus.on("alert",((t,...e)=>{this.emit(t)})),this.iframe=document.getElementsByClassName("comb-frame-0")[0],this.iframe.setAttribute("allowtransparency","true");const e=this.iframe.style;e.zIndex="99999999",e.width="100%",e.height="100%",e.position="absolute",e.top="0",e.left="0",e.display="none"}async context(){return xc.HOSTED_ANONYMOUS}async zomeCall(...t){return await this.child.call("zomeCall",...t)}async appInfo(...t){return await this.child.call("appInfo",...t)}async signUp(){this.iframe.style.display="block";const t=await this.child.call("signUp");return this.iframe.style.display="none",t}async signIn(){this.iframe.style.display="block";const t=await this.child.call("signIn");return this.iframe.style.display="none",t}async signOut(){return await this.child.run("signOut")}async holoInfo(){return await this.child.run("holoInfo")}}var Sc;xc.AUTONOMOUS=1,xc.HOSTED_ANONYMOUS=2,xc.HOSTED_AGENT=3,function(t){t.Active="active",t.Inactive="inactive"}(Sc||(Sc={}));var Ec=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class Cc{constructor(t,e){this.socket=t,this.pendingRequests={},this.index=0,this.alreadyWarnedNoSignalCb=!1,t.onmessage=t=>Ec(this,void 0,void 0,(function*(){let n=t.data;"undefined"!=typeof Buffer&&Buffer.isBuffer(n)||(n=yield n.arrayBuffer());const r=Ra(n);if("Signal"===r.type)if(e){const t=Ra(r.data),n=t.App[0],i=kc(t.App[1]),o={type:r.type,data:{cellId:n,payload:i}};e(o)}else this.alreadyWarnedNoSignalCb||console.log("Received signal but no signal callback was set in constructor"),this.alreadyWarnedNoSignalCb=!0;else"Response"===r.type?this.handleResponse(r):console.error(`Got unrecognized Websocket message type: ${r.type}`)}))}emitSignal(t){const e=_a({type:"Signal",data:_a(t)});this.socket.send(e)}request(t){let e=this.index;this.index+=1;const n=_a({id:e,type:"Request",data:_a(t)}),r=new Promise(((t,n)=>{this.pendingRequests[e]={fulfill:t,reject:n}}));return this.socket.readyState!==this.socket.OPEN?Promise.reject(new Error("Socket is not open")):(this.socket.send(n),r)}handleResponse(t){const e=t.id;this.pendingRequests[e]?null===t.data||void 0===t.data?this.pendingRequests[e].reject(new Error("Response canceled by responder")):this.pendingRequests[e].fulfill(Ra(t.data)):console.error(`Got response with no matching request. id=${e}`)}close(){return this.socket.close(),this.awaitClose()}awaitClose(){return new Promise((t=>this.socket.on("close",t)))}static connect(t,e){return new Promise(((n,r)=>{const i=new ra(t);i.onerror=e=>{r(new Error(`could not connect to holochain conductor, please check that a conductor service is running and available at ${t}`))},i.onopen=()=>{n(new Cc(i,e))}}))}}const kc=t=>Ra(t),$c=t=>"error"===t.type?Promise.reject(t):Promise.resolve(t);var Uc=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};const Ac=t=>t,jc={input:Ac,output:Ac};var Oc=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))};class Ic{constructor(t,e){this._requester=(t,e)=>((t,e,n=jc)=>(r,i)=>Uc(void 0,void 0,void 0,(function*(){const o={type:e,data:n.input(r)},s=yield t(o,i);return n.output(s.data)})))(((e,n)=>((t,e,n)=>{let r,i=new Promise(((t,i)=>{r=setTimeout((()=>{clearTimeout(r),i(new Error(`Timed out in ${n}ms: ${e}`))}),n)}));return new Promise(((e,n)=>{Promise.race([t,i]).then((t=>(clearTimeout(r),e(t)))).catch((t=>n(t)))}))})(this.client.request(e),t,n||this.defaultTimeout).then($c)),t,e),this.appInfo=this._requester("app_info"),this.callZome=this._requester("zome_call_invocation",Tc),this.client=t,this.defaultTimeout=void 0===e?15e3:e}static connect(t,e,n){return Oc(this,void 0,void 0,(function*(){const r=yield Cc.connect(t,n);return new Ic(r,e)}))}}const Tc={input:t=>Object.assign(Object.assign({},t),{payload:_a(t.payload)}),output:t=>Ra(t)};class Pc{constructor(t,e){this.appWebsocket=t,this.cellData=e}get cellId(){return this.cellData.cell_id}callZome(t,e,n){return this.appWebsocket.callZome({cap:null,cell_id:this.cellId,zome_name:t,fn_name:e,payload:n,provenance:this.cellId[1]})}async addSignalHandler(t){const e=await Ic.connect(this.appWebsocket.client.socket.url,15e3,t);return{unsubscribe:()=>{e.client.close()}}}}function Lc(t,e){switch(console.log(t,e),e.type){case"Title":return t.title,t.title=e.value,t;case"Add":{const[n,r]=e.value;return console.log(t.body.slice(0,n)+r+t.body.slice(n)),t.body=t.body.slice(0,n)+r+t.body.slice(n),t}case"Delete":{const[n,r]=e.value;return t.body.slice(n,r),t.body=t.body.slice(0,n)+t.body.slice(r),t}case"Meta":{const[n,r]=e.value.setLoc;return t.meta[n],t.meta[n]=r,t}}}const{document:Bc}=W;function Rc(e){let n,o,s,a,c,u,l,y,w,_,S,E,C,k,$,U,A,j,O,I,T,P,L,B,R,M,D,z,H,F;return c=new Ds({}),c.$on("requestChange",e[14]),w=new Is({}),w.$on("requestChange",e[15]),B=new Ys({props:{changeToTextFn:Dc}}),M=new Ns({}),{c(){n=p("div"),o=p("h1"),o.textContent="SynText",s=v(),a=p("div"),V(c.$$.fragment),u=v(),l=p("main"),y=p("div"),V(w.$$.fragment),_=v(),S=p("div"),E=p("syn-context"),C=p("syn-folks"),k=v(),$=p("div"),U=p("div"),A=p("i"),O=v(),I=p("div"),T=p("div"),P=v(),L=p("div"),V(B.$$.fragment),R=v(),V(M.$$.fragment),m(o,"class","svelte-1ygbi8h"),x(a,"noscribe",e[5]),m(n,"class","toolbar svelte-1ygbi8h"),x(y,"noscribe",e[5]),m(l,"class","svelte-1ygbi8h"),b(E,"store",e[0]),m(S,"class","folks-tray svelte-1ygbi8h"),m(A,"class",j="tab-icon fas "+(e[3]?"fa-chevron-up":"fa-chevron-down")+" svelte-1ygbi8h"),x(A,"drawer-hidden",e[3]),m(U,"class","tab-inner svelte-1ygbi8h"),x(U,"shown",e[4]),m($,"class","tab svelte-1ygbi8h"),x($,"shown",e[4]),x($,"drawer-hidden",e[3]),m(T,"class","handle svelte-1ygbi8h"),m(L,"class","debug-content svelte-1ygbi8h"),m(I,"class","debug-drawer svelte-1ygbi8h"),x(I,"hidden",e[3])},m(r,d){var p;f(r,n,d),h(n,o),h(n,s),h(n,a),K(c,a,null),f(r,u,d),f(r,l,d),h(l,y),K(w,y,null),f(r,_,d),f(r,S,d),h(S,E),h(E,C),f(r,k,d),f(r,$,d),h($,U),h(U,A),f(r,O,d),f(r,I,d),h(I,T),e[16](T),h(I,P),h(I,L),K(B,L,null),h(L,R),K(M,L,null),e[17](I),z=!0,H||(F=[g(U,"click",(function(){i(e[3]?e[10]():e[9]())&&(e[3]?e[10]():e[9]()).apply(this,arguments)})),g($,"mouseenter",e[11]),g($,"mouseleave",e[12]),g(T,"mousedown",e[8]),(p=D=e[7].call(null,I),p&&i(p.destroy)?p.destroy:t),g(I,"mouseenter",e[11]),g(I,"mouseleave",e[12])],H=!0)},p(t,n){e=t,32&n&&x(a,"noscribe",e[5]),32&n&&x(y,"noscribe",e[5]),(!z||1&n)&&b(E,"store",e[0]),(!z||8&n&&j!==(j="tab-icon fas "+(e[3]?"fa-chevron-up":"fa-chevron-down")+" svelte-1ygbi8h"))&&m(A,"class",j),8&n&&x(A,"drawer-hidden",e[3]),16&n&&x(U,"shown",e[4]),16&n&&x($,"shown",e[4]),8&n&&x($,"drawer-hidden",e[3]),8&n&&x(I,"hidden",e[3])},i(t){z||(q(c.$$.fragment,t),q(w.$$.fragment,t),q(B.$$.fragment,t),q(M.$$.fragment,t),z=!0)},o(t){N(c.$$.fragment,t),N(w.$$.fragment,t),N(B.$$.fragment,t),N(M.$$.fragment,t),z=!1},d(t){t&&d(n),Z(c),t&&d(u),t&&d(l),Z(w),t&&d(_),t&&d(S),t&&d(k),t&&d($),t&&d(O),t&&d(I),e[16](null),Z(B),Z(M),e[17](null),H=!1,r(F)}}}function Mc(t){let e,n,r,i,o,a=t[0]&&Rc(t);return{c(){var t,o;e=p("script"),r=v(),a&&a.c(),i=y(""),t=e.src,o=n="https://kit.fontawesome.com/80d72fa568.js",s||(s=document.createElement("a")),s.href=o,t!==s.href&&m(e,"src","https://kit.fontawesome.com/80d72fa568.js"),m(e,"crossorigin","anonymous")},m(t,n){h(Bc.head,e),f(t,r,n),a&&a.m(t,n),f(t,i,n),o=!0},p(t,[e]){t[0]?a?(a.p(t,e),1&e&&q(a,1)):(a=Rc(t),a.c(),q(a,1),a.m(i.parentNode,i)):a&&(H(),N(a,1,1,(()=>{a=null})),F())},i(t){o||(q(a),o=!0)},o(t){N(a),o=!1},d(t){d(e),t&&d(r),a&&a.d(t),t&&d(i)}}}function Dc(t){let e,n=t.delta;switch(n.type){case"Add":e=`${n.value[1]}@${n.value[0]}`;break;case"Delete":e=`${t.deleted}@${n.value[0]}`;break;case"Title":e=`${t.deleted}->${n.value}`;break;case"Meta":e=""}return`${n.type}:\n${e}`}function zc(t,e,n){let r,i,o,s,a;l(t,rt,(t=>n(13,i=t)));const c=document.documentElement.clientHeight-30-10,u=t=>{document.documentElement.style.setProperty("--resizeable-height",`${t}px`)},h=()=>{const t=getComputedStyle(s).getPropertyValue("--resizeable-height");return parseInt(t,10)};let f=!1;let d=!1;let p;var y,v;(async function(){const t=await Va.connect("ws://localhost:undefined"),e=await t.appInfo({installed_app_id:"syn"});return ks(new Pc(t,e.cell_data[0]),{title:"",body:"",meta:{}},Lc)})().then((t=>{t.newSession().then((()=>{n(0,p=t)}))})),customElements.define("syn-context",Te),customElements.define("syn-folks",Ve),y="store",v={getStore:()=>p},E().$$.context.set(y,v);return t.$$.update=()=>{8192&t.$$.dirty&&n(5,r=""===i),t.$$.dirty},[p,s,a,f,d,r,o,t=>{t.style.setProperty("--max-height",`${c}px`),t.style.setProperty("--min-height","0px")},t=>{t.preventDefault();const e=h(),n=t.pageY,r=t=>{t.preventDefault();if(!(1===t.buttons))return u(Math.min(Math.max(h(),0),c)),void window.removeEventListener("pointermove",r);u(Math.min(Math.max(n-t.pageY+e,0),c))};window.addEventListener("pointermove",r)},()=>{n(3,f=!0)},()=>{n(3,f=!1)},()=>{n(4,d=!0)},()=>{n(4,d=!1)},i,t=>p.activeSession.requestChange([t.detail]),t=>o.requestChange(t.detail),function(t){U[t?"unshift":"push"]((()=>{a=t,n(2,a)}))},function(t){U[t?"unshift":"push"]((()=>{s=t,n(1,s)}))}]}return new class extends X{constructor(t){super(),G(this,t,zc,Mc,o,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
